/**
 * @license
 * KLineChart v7.5.0
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";var e={technicalIndicatorExtensions:{},graphicMarkExtensions:{},addTechnicalIndicator:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.technicalIndicatorExtensions[t.name]=t)}))},addGraphicMark:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.graphicMarkExtensions[t.name]=t)}))}};function i(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function a(t){for(var e=1;arguments.length>e;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){h(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;e.length>i;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return d(this,i)}}function v(t,e,i){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=Array(e);e>i;i++)a[i]=t[i];return a}function p(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return f(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var a=0,n=function(){};return{s:n,n:function(){return t.length>a?{done:!1,value:t[a++]}:{done:!0}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw s}}}}function y(t,e){if(k(t)&&k(e))for(var i in e)if(i in t){var a=t[i],n=e[i];k(n)&&k(a)&&!x(n)&&!x(a)?y(a,n):w(e[i])&&(t[i]=e[i])}}function m(t){if(!k(t))return t;var e;for(var i in e=x(t)?[]:{},t)if(t.hasOwnProperty(i)){var a=t[i];e[i]=k(a)?m(a):a}return e}function x(t){return"[object Array]"===Object.prototype.toString.call(t)}function g(t){return"function"==typeof t}function k(t){return!!t&&"object"===n(t)}function D(t){return"number"==typeof t&&!isNaN(t)}function w(t){return null!=t}function b(t){return"boolean"==typeof t}function P(t){return"string"==typeof t}function E(t){return t&&t instanceof HTMLElement&&t.appendChild&&"function"==typeof t.appendChild}var M="dash",C="left",T="right",A="normal",S="percentage",I="log",L="candle_solid",O="candle_stroke",F="candle_up_stroke",z="candle_down_stroke",R="ohlc",B="area",H="always",V="follow_cross",Y="rect",W="standard",N="circle",G="rect",X="triangle",j="diamond",Z="custom",U="point",K="top",q="bottom",$={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:M,dashValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:M,dashValue:[2,2]}},candle:{margin:{top:.2,bottom:.1},type:L,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",fillColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:M,dashValue:[4,4],size:1},text:{show:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:H,showType:W,labels:["时间: ","开: ","收: ","高: ","低: ","成交量: "],values:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",fillColor:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},technicalIndicator:{margin:{top:.2,bottom:.1},bar:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},line:{size:1,colors:["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"]},circle:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},lastValueMark:{show:!1,text:{show:!1,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingTop:2,paddingRight:3,paddingBottom:2,borderRadius:2}},tooltip:{showRule:H,showType:W,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,height:null,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingTop:3,paddingBottom:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,width:null,type:A,position:T,inside:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingRight:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:M,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#686D76",borderRadius:2,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:M,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderRadius:2,borderColor:"#686D76",backgroundColor:"#686D76"}}},graphicMark:{point:{backgroundColor:"#2196F3",borderColor:"rgba(33, 150, 243, 0.35)",borderSize:1,radius:5,activeBackgroundColor:"#2196F3",activeBorderColor:"rgba(33, 150, 243, 0.35)",activeBorderSize:3,activeRadius:5},line:{color:"#2196F3",size:1,dashValue:[2,2]},polygon:{stroke:{size:1,color:"#2196F3"},fill:{color:"rgba(33, 150, 243, 0.1)"}},arc:{stroke:{size:1,color:"#2196F3"},fill:{color:"rgba(33, 150, 243, 0.1)"}},text:{color:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",marginLeft:2,marginRight:2,marginTop:2,marginBottom:6}},annotation:{symbol:{type:j,position:K,size:8,color:"#2196F3",activeSize:10,activeColor:"#FF9600",offset:[0,20]}},tag:{position:U,offset:0,line:{show:!0,style:M,dashValue:[4,2],size:1,color:"#2196F3"},text:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2},mark:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2}}};function J(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(k(t)){var a=t[e];if(w(a))return a}return i}function Q(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MM-DD hh:mm";if(D(e)){var a=t.format(new Date(e)),n=a.split(", "),s=n[0].split("/"),r={YYYY:s[2],MM:s[0],DD:s[1],"hh:mm":"24"===n[1].match(/^[\d]{2}/)[0]?n[1].replace(/^[\d]{2}/,"00"):n[1]};return i.replace(/YYYY|MM|DD|(hh:mm)/g,(function(t){return r[t]}))}return"--"}function tt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&D(i)?i.toFixed(e):"".concat(i)}function et(t){return D(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}function it(t,e){return null==e&&(e=10),+(t=(+t).toFixed(e=Math.min(Math.max(0,e),20)))}function at(t){return Math.log(t)/Math.log(10)}function nt(t){return Math.pow(10,t)}var st="price",rt="volume",ot="line",ht="bar",ct="circle",lt=function(){function t(e){var i=e.name,a=e.series,n=e.calcParams,r=e.plots,o=e.precision,h=e.calcParamsAllowDecimal,c=e.shouldCheckParamCount,l=e.shouldOhlc,u=e.shouldFormatBigNumber,d=e.baseValue,_=e.minValue,v=e.maxValue,f=e.styles;s(this,t),this.name=i||"",this.series=a||"normal",this.precision=D(o)&&o>=0?o:4,this.calcParams=x(n)?n:[],this.plots=x(r)?r:[],this.calcParamsAllowDecimal=k(h)?h:{},this.shouldCheckParamCount=!b(c)||c,this.shouldOhlc=l,this.shouldFormatBigNumber=u,this.baseValue=D(d)?d:null,this.minValue=_,this.maxValue=v,this.styles=f}return o(t,[{key:"setPrecision",value:function(t){return!(!D(t)||0>t)&&(this.precision=parseInt(t,10),!0)}},{key:"setCalcParamsAllowDecimal",value:function(t){k(t)&&(this.calcParamsAllowDecimal=t)}},{key:"setCalcParams",value:function(t){if(!x(t))return!1;if(this.shouldCheckParamCount&&t.length!==this.calcParams.length)return!1;for(var e=0;t.length>e;e++){var i=t[e];if(!D(i)||0>=i||!this.calcParamsAllowDecimal[e]&&parseInt(i,10)!==i)return!1}this.calcParams=m(t);var a=this.regeneratePlots(t);return a&&x(a)&&(this.plots=a),!0}},{key:"setStyles",value:function(t,e){return!!k(t)&&(this.styles||(this.styles={bar:m(e.bar),line:m(e.line),circle:m(e.circle)}),y(this.styles,t),!0)}},{key:"calcTechnicalIndicator",value:function(t,e){}},{key:"regeneratePlots",value:function(t){}}]),t}();function ut(t){var e=t.name,i=t.series,a=t.calcParams,n=t.plots,r=t.precision,o=t.calcParamsAllowDecimal,h=t.shouldCheckParamCount,l=t.shouldOhlc,u=t.shouldFormatBigNumber,d=t.baseValue,v=t.minValue,f=t.maxValue,p=t.styles,y=t.calcTechnicalIndicator,m=t.regeneratePlots,x=t.render;if(!e||!g(y))return null;var k=function(t){c(m,t);var y=_(m);function m(){return s(this,m),y.call(this,{name:e,series:i,calcParams:a,plots:n,precision:r,calcParamsAllowDecimal:o,shouldCheckParamCount:h,shouldOhlc:l,shouldFormatBigNumber:u,baseValue:d,minValue:v,maxValue:f,styles:p})}return m}(lt);return k.prototype.calcTechnicalIndicator=y,m&&g(m)&&(k.prototype.regeneratePlots=m),x&&g(x)&&(k.prototype.render=x),new k}function dt(t){return{name:t.name,series:t.series,calcParams:t.calcParams,calcParamsAllowDecimal:t.calcParamsAllowDecimal,shouldCheckParamCount:t.shouldCheckParamCount,shouldOhlc:t.shouldOhlc,shouldFormatBigNumber:t.shouldFormatBigNumber,precision:t.precision,styles:t.styles,result:t.result||[]}}function _t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,i=e.calcParams,a=e.plots,n=e.precision,s=e.shouldFormatBigNumber,r=[],o="",h="";return a.length>0&&(o=e.name),i.length>0&&(h="(".concat(i.join(","),")")),a.forEach((function(e){var i={};if(w(e.title)){var a=t[e.key];w(a)&&(a=tt(a,n),s&&(a=et(a))),i.title=e.title,i.value=a}r.push(i)})),{values:r,name:o,calcParamText:h}}var vt=function(){function t(e){var i=e.id,a=e.chartData,n=e.xAxis,r=e.yAxis;s(this,t),this._id=i,this._chartData=a,this._xAxis=n,this._yAxis=r,this._styles=null}return o(t,[{key:"draw",value:function(t){}},{key:"setStyles",value:function(t,e){return!!k(t)&&(this._styles||(this._styles=m(e)),y(this._styles,t),!0)}},{key:"id",value:function(){return this._id}},{key:"styles",value:function(){return this._styles}},{key:"checkMousePointOnGraphic",value:function(t){}},{key:"onClick",value:function(t){}},{key:"onRightClick",value:function(t){}},{key:"onMouseEnter",value:function(t){}},{key:"onMouseLeave",value:function(t){}}]),t}();function ft(t,e,i,a){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,a,0,2*Math.PI),t.closePath(),t.fill()}function pt(t,e,i){var a=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),s=Math.abs(i.x-t.x);return Math.abs(a*Math.abs(i.y-t.y)-s*n)/2}function yt(t,e,i){if(!i)return!1;var a=i.x-t.x,n=i.y-t.y;return!(a*a+n*n>e*e)}function mt(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(i,e+n),t.lineTo(a,e+n),t.stroke(),t.closePath()}function xt(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(e+n,i),t.lineTo(e+n,a),t.stroke(),t.closePath()}function gt(t,e){t.save(),t.lineWidth%2&&t.translate(.5,.5),e(),t.restore()}var kt="other",Dt="point",wt="none",bt="line",Pt="text",Et="continuous_line",Mt="polygon",Ct="arc",Tt="stroke",At="fill",St="dash",It=0,Lt=1,Ot=2;var Ft=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,r=t.name,o=t.totalStep,h=t.chartData,c=t.xAxis,l=t.yAxis,u=t.points,d=t.styles,_=t.lock;return s(this,i),(a=e.call(this,{id:n,chartData:h,xAxis:c,yAxis:l}))._name=r,a._totalStep=o,a._lock=_,a._drawStep=1,a._points=[],a.setPoints(u),a.setStyles(d,h.styleOptions().graphicMark),a}return o(i,[{key:"setPoints",value:function(t){if(x(t)&&t.length>0){var e;this._totalStep-1>t.length?(this._drawStep=t.length+1,this._points=m(t),e=t.length):(this._drawStep=-1,this._points=t.slice(0,this._totalStep-1),e=this._totalStep-1);for(var i=0;e>i;i++)this.performMouseMoveForDrawing(i+2,this.points,this._points[i],this._xAxis,this._yAxis);-1===this._drawStep&&this.performMousePressedMove(this._points,this._points.length-1,this._points[this._points.length-1],this._xAxis,this._yAxis)}}},{key:"_timestampOrDataIndexToPointX",value:function(t){var e=t.timestamp,i=t.dataIndex;return this._xAxis.convertToPixel(e?this._chartData.timestampToDataIndex(e):i)}},{key:"_drawLines",value:function(t,e,i,a){t.save(),t.strokeStyle=a.line.color,t.lineWidth=a.line.size,i===St&&t.setLineDash(a.line.dashValue),e.forEach((function(e){var i,a;if(e.length>1)switch((i=e[0]).x===(a=e[1]).x?Ot:i.y===a.y?Lt:It){case It:gt(t,(function(){t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.closePath()}));break;case Lt:mt(t,e[0].y,e[0].x,e[1].x);break;case Ot:xt(t,e[0].x,e[0].y,e[1].y)}})),t.restore()}},{key:"_drawContinuousLines",value:function(t,e,i,a){t.save(),t.strokeStyle=a.line.color,t.lineWidth=a.line.size,i===St&&t.setLineDash(a.line.dashValue),e.forEach((function(e){e.length>0&&gt(t,(function(){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;e.length>i;i++)t.lineTo(e[i].x,e[i].y);t.stroke(),t.closePath()}))})),t.restore()}},{key:"_drawPolygons",value:function(t,e,i,a){var n;t.save(),i===At?(t.fillStyle=a.polygon.fill.color,n=t.fill):(t.lineWidth=a.polygon.stroke.size,t.strokeStyle=a.polygon.stroke.color,n=t.stroke),e.forEach((function(e){e.length>0&&gt(t,(function(){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;e.length>i;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),n.call(t)}))})),t.restore()}},{key:"_drawArcs",value:function(t,e,i,a){t.save(),i===At?t.fillStyle=a.arc.fill.color:(t.lineWidth=a.arc.stroke.size,t.strokeStyle=a.arc.stroke.color),e.forEach((function(e){var a=e.x,n=e.y,s=e.radius,r=e.startAngle,o=e.endAngle;t.beginPath(),t.arc(a,n,s,r,o),i===At?(t.closePath(),t.fill()):(t.stroke(),t.closePath())})),t.restore()}},{key:"_drawText",value:function(t,e,i,a){var n;t.save(),i===Tt?(t.strokeStyle=a.text.color,n=t.strokeText):(t.fillStyle=a.text.color,n=t.fillText),t.font="".concat(a.text.weight," ").concat(a.text.size,"px ").concat(a.text.family),e.forEach((function(e){n.call(t,e.text,e.x+a.text.marginLeft,e.y-a.text.marginBottom)})),t.restore()}},{key:"draw",value:function(t){var e=this,i=this._points.map((function(t){var i=t.price;return{x:e._timestampOrDataIndexToPointX({timestamp:t.timestamp,dataIndex:t.dataIndex}),y:e._yAxis.convertToPixel(i)}})),a=this._styles||this._chartData.styleOptions().graphicMark;if(1!==this._drawStep&&i.length>0){var n={width:this._xAxis.width(),height:this._yAxis.height()},s={price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()},r=this.createGraphicDataSource(this._drawStep,this._points,i,n,s,this._xAxis,this._yAxis)||[];r.forEach((function(i){var n=i.type,s=i.isDraw,r=i.style,o=i.dataSource,h=void 0===o?[]:o;if(!w(s)||s)switch(n){case bt:e._drawLines(t,h,r,a);break;case Et:e._drawContinuousLines(t,h,r,a);break;case Mt:e._drawPolygons(t,h,r,a);break;case Ct:e._drawArcs(t,h,r,a);break;case Pt:e._drawText(t,h,r,a)}})),this.drawExtend&&(t.save(),this.drawExtend(t,r,a,n,s,this._xAxis,this._yAxis),t.restore())}var o=this._chartData.graphicMarkMouseOperate();(o.hover.id===this._id&&o.hover.element!==wt||o.click.id===this._id&&o.click.element!==wt)&&i.forEach((function(i,n){var s=i.x,r=i.y,h=a.point.radius,c=a.point.backgroundColor,l=a.point.borderColor,u=a.point.borderSize;o.hover.id===e._id&&o.hover.element===Dt&&n===o.hover.elementIndex&&(h=a.point.activeRadius,c=a.point.activeBackgroundColor,l=a.point.activeBorderColor,u=a.point.activeBorderSize),ft(t,l,{x:s,y:r},h+u),ft(t,c,{x:s,y:r},h)}))}},{key:"setLock",value:function(t){this._lock=t}},{key:"name",value:function(){return this._name}},{key:"lock",value:function(){return this._lock}},{key:"totalStep",value:function(){return this._totalStep}},{key:"points",value:function(){return this._points}},{key:"isDrawing",value:function(){return-1!==this._drawStep}},{key:"checkMousePointOnGraphic",value:function(t){for(var e=this._styles||this._chartData.styleOptions().graphicMark,i=[],a=0;this._points.length>a;a++){var n=this._points[a],s=n.price,r={x:this._timestampOrDataIndexToPointX({timestamp:n.timestamp,dataIndex:n.dataIndex}),y:this._yAxis.convertToPixel(s)};if(i.push(r),yt(r,e.point.radius,t))return{id:this._id,element:Dt,elementIndex:a,instance:this}}var o,h=p(this.createGraphicDataSource(this._drawStep,this._points,i,{width:this._xAxis.width(),height:this._yAxis.height()},{price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()},this._xAxis,this._yAxis)||[]);try{for(h.s();!(o=h.n()).done;){var c=o.value,l=c.key,u=c.type,d=c.dataSource,_=void 0===d?[]:d;if(c.isCheck)for(var v=0;_.length>v;v++){if(this.checkMousePointOn(l,u,_[v],t))return{id:this._id,element:kt,elementIndex:v,instance:this}}}}catch(t){h.e(t)}finally{h.f()}}},{key:"mouseMoveForDrawing",value:function(t){var e=this._xAxis.convertFromPixel(t.x),i=this._chartData.dataIndexToTimestamp(e),a=this._yAxis.convertFromPixel(t.y);this._points[this._drawStep-1]={timestamp:i,price:a,dataIndex:e},this.performMouseMoveForDrawing(this._drawStep,this._points,{timestamp:i,price:a,dataIndex:e},this._xAxis,this._yAxis),this.onDrawing({id:this._id,step:this._drawStep,points:this._points})}},{key:"mouseLeftButtonDownForDrawing",value:function(){this._drawStep===this._totalStep-1?(this._drawStep=-1,this.onDrawEnd({id:this._id,points:this._points})):this._drawStep++}},{key:"mousePressedMove",value:function(t,e){var i=this._chartData.graphicMarkMouseOperate(),a=i.click.elementIndex;if(!this._lock&&i.click.id===this._id&&i.click.element===Dt&&-1!==a){var n=this._xAxis.convertFromPixel(t.x),s=this._chartData.dataIndexToTimestamp(n),r=this._yAxis.convertFromPixel(t.y);this._points[a].timestamp=s,this._points[a].dataIndex=n,this._points[a].price=r,this.performMousePressedMove(this._points,a,{dataIndex:n,timestamp:s,price:r},this._xAxis,this._yAxis),this.onPressedMove({id:i.click.id,points:this._points,event:e})}}},{key:"onDrawStart",value:function(t){}},{key:"onDrawing",value:function(t){}},{key:"onDrawEnd",value:function(t){}},{key:"onPressedMove",value:function(t){}},{key:"onRemove",value:function(t){}},{key:"checkMousePointOn",value:function(t,e,i,a){}},{key:"createGraphicDataSource",value:function(t,e,i,a,n,s,r){}},{key:"performMouseMoveForDrawing",value:function(t,e,i,a,n){}},{key:"performMousePressedMove",value:function(t,e,i,a,n){}}]),i}(vt),zt=function(){function t(){s(this,t),this._observers=[]}return o(t,[{key:"subscribe",value:function(t){0>this._observers.indexOf(t)&&this._observers.push(t)}},{key:"unsubscribe",value:function(t){var e=this._observers.indexOf(t);e>-1?this._observers.splice(e,1):this._observers=[]}},{key:"execute",value:function(t){this._observers.forEach((function(e){e(t)}))}},{key:"hasObservers",value:function(){return this._observers.length>0}}]),t}();function Rt(t){var e=t.name,i=t.totalStep,a=t.checkMousePointOn,n=t.createGraphicDataSource,r=t.performMousePressedMove,o=t.performMouseMoveForDrawing,h=t.drawExtend;if(!(e&&D(i)&&g(a)&&g(n)))return null;var l=function(t){c(n,t);var a=_(n);function n(t){var r=t.id,o=t.chartData,h=t.xAxis,c=t.yAxis,l=t.points,u=t.styles,d=t.lock;return s(this,n),a.call(this,{id:r,name:e,totalStep:i,chartData:o,xAxis:h,yAxis:c,points:l,styles:u,lock:d})}return n}(Ft);return l.prototype.checkMousePointOn=a,l.prototype.createGraphicDataSource=n,g(r)&&(l.prototype.performMousePressedMove=r),g(o)&&(l.prototype.performMouseMoveForDrawing=o),g(h)&&(l.prototype.drawExtend=h),l}function Bt(t){return{name:t.name(),id:t.id(),totalStep:t.totalStep(),lock:t.lock(),points:t.tpPoints(),styles:t.styles()}}var Ht="technical_indicator_pane_",Vt="graphic_mark_",Yt="candle_pane",Wt=1,Nt=2,Gt=3,Xt={DRAW_CANDLE:"drawCandle",DRAW_TECHNICAL_INDICATOR:"drawTechnicalIndicator",ZOOM:"zoom",SCROLL:"scroll",CROSSHAIR:"crosshair",PANE_DRAG:"pane_drag"},jt=function(){function t(i,a){s(this,t),this._handler=a,this._styleOptions=m($),y(this._styleOptions,i),this._technicalIndicatorMapping=function(){var t={},i=e.technicalIndicatorExtensions;for(var a in i){var n=ut(i[a]);n&&(t[a]=n)}return t}(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._pricePrecision=2,this._volumePrecision=0,this._dateTimeFormat=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),this._dataList=[],this._visibleDataList=[],this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightSpace=50,this._offsetRightBarCount=this._offsetRightSpace/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._crosshair={},this._preOffsetRightBarCount=0,this._dragGraphicMarkFlag=!1,this._graphicMarkMapping=function(){var t={},i=e.graphicMarkExtensions;for(var a in i){var n=Rt(i[a]);n&&(t[a]=n)}return t}(),this._graphicMarkMouseOperate={click:{id:"",element:wt,elementIndex:-1},hover:{id:"",element:wt,elementIndex:-1}},this._graphicMarks=[],this._annotations=new Map,this._visibleAnnotations=[],this._annotationMouseOperate={id:""},this._tags=new Map,this._dragPaneFlag=!1,this._actionDelegate=new Map}return o(t,[{key:"_calcBarSpace",value:function(){return Math.max(1,Math.min(Math.floor(.8*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"_adjustVisibleDataList",value:function(){var t=this._dataList.length;this._visibleDataList=[],this._visibleAnnotations=[];for(var e=this._from;this._to>e;e++){var i=this._dataList[e],a=this._totalDataSpace-(t+this._offsetRightBarCount-e-.5)*this._dataSpace;this._visibleDataList.push({index:e,x:a,data:i});var n=this._annotations.get(i.timestamp)||[];if(n.length>0){var s,r=p(n);try{for(r.s();!(s=r.n()).done;){var o=s.value;o.createSymbolCoordinate(a),this._visibleAnnotations.push(o)}}catch(t){r.e(t)}finally{r.f()}}}}},{key:"_adjustFromTo",value:function(){var t=this._dataList.length,e=this._totalDataSpace/this._dataSpace,i=e-Math.min(this._leftMinVisibleBarCount,t);this._offsetRightBarCount>i&&(this._offsetRightBarCount=i);var a=-t+Math.min(this._rightMinVisibleBarCount,t);a>this._offsetRightBarCount&&(this._offsetRightBarCount=a),this._to=Math.round(this._offsetRightBarCount+t+.5),this._from=Math.round(this._to-e)-1,this._to>t&&(this._to=t),0>this._from&&(this._from=0),this._adjustVisibleDataList(),0===this._from&&this._more&&!this._loading&&this._loadMoreCallback&&g(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(J(this._dataList[0],"timestamp")))}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){y(this._styleOptions,t)}},{key:"getTechnicalIndicatorInfo",value:function(t){if(!w(t)){var e={};for(var i in this._technicalIndicatorMapping){e[i]=dt(this._technicalIndicatorMapping[i])}return e}var a=this.getTechnicalIndicatorInstance(t);return a?dt(a):{}}},{key:"getTechnicalIndicatorInstance",value:function(t){return this._technicalIndicatorMapping[t]}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"dateTimeFormat",value:function(){return this._dateTimeFormat}},{key:"setTimezone",value:function(t){var e;try{e=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){}e&&(this._dateTimeFormat=e)}},{key:"timezone",value:function(){return this._dateTimeFormat.resolvedOptions().timeZone}},{key:"setPriceVolumePrecision",value:function(t,e){for(var i in this._pricePrecision=t,this._volumePrecision=e,this._technicalIndicatorMapping){switch(this._technicalIndicatorMapping[i].series){case st:this._technicalIndicatorMapping[i].setPrecision(t);break;case rt:this._technicalIndicatorMapping[i].setPrecision(e)}}}},{key:"dataList",value:function(){return this._dataList}},{key:"visibleDataList",value:function(){return this._visibleDataList}},{key:"clearDataList",value:function(){this._more=!0,this._loading=!0,this._dataList=[],this._visibleDataList=[],this._from=0,this._to=0}},{key:"addData",value:function(t,e,i){if(k(t)){if(x(t)){this._loading=!1,this._more=!b(i)||i;var a=0===this._dataList.length;this._dataList=t.concat(this._dataList),a&&this.setOffsetRightSpace(this._offsetRightSpace),this._adjustFromTo()}else{this._dataList.length>e?(this._dataList[e]=t,this._adjustVisibleDataList()):(this._dataList.push(t),0>this._offsetRightBarCount&&(this._offsetRightBarCount-=1),this._adjustFromTo())}this.setCrosshair(this._crosshair,!0)}}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"setDataSpace",value:function(t,e){1>t||t>50||this._dataSpace===t||(this._dataSpace=t,this._barSpace=this._calcBarSpace(),e&&e(),this._adjustFromTo(),this.setCrosshair(this._crosshair,!0),this.invalidate())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this._adjustFromTo(),this.setCrosshair(this._crosshair,!0))}},{key:"setOffsetRightSpace",value:function(t,e){this._offsetRightSpace=t,this._offsetRightBarCount=t/this._dataSpace,e&&(this._adjustFromTo(),this.setCrosshair(this._crosshair,!0),this.invalidate())}},{key:"offsetRightSpace",value:function(){return this._offsetRightSpace}},{key:"offsetRightBarCount",value:function(){return this._offsetRightBarCount}},{key:"setLeftMinVisibleBarCount",value:function(t){this._leftMinVisibleBarCount=t}},{key:"setRightMinVisibleBarCount",value:function(t){this._rightMinVisibleBarCount=t}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"crosshair",value:function(){return this._crosshair}},{key:"setCrosshair",value:function(t,e){var i,n,s=t||{};n=w(s.x)?0>(i=this.coordinateToDataIndex(s.x))?0:i>this._dataList.length-1?this._dataList.length-1:i:i=this._dataList.length-1;var r=this._dataList[n],o=this.dataIndexToCoordinate(i),h=this._crosshair.x,c=this._crosshair.y,l=this._crosshair.paneId;this._crosshair=a(a({},s),{},{realX:o,kLineData:r,realDataIndex:i,dataIndex:n}),s.paneId&&r&&this._handler.crosshair({realDataIndex:i,dataIndex:n,kLineData:r,x:s.x,y:s.y}),h===s.x&&c===s.y&&l===s.paneId||e||this.invalidate(Wt)}},{key:"startScroll",value:function(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value:function(t,e){if(this._scrollEnabled){var i=t/this._dataSpace;this.actionExecute(Xt.SCROLL,{barCount:i,distance:t}),this._offsetRightBarCount=this._preOffsetRightBarCount-i,this._adjustFromTo(),this.setCrosshair(e||this._crosshair,!0),this.invalidate()}}},{key:"coordinateToFloatIndex",value:function(t){return Math.round(1e6*(this._dataList.length+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"dataIndexToTimestamp",value:function(t){var e=this._dataList[t];if(e)return e.timestamp}},{key:"timestampToDataIndex",value:function(t){return 0===this._dataList.length?0:function(t,e,i){var a=0,n=0;for(n=t.length-1;a!==n;){var s=Math.floor((n+a)/2),r=n-a,o=t[s][e];if(i===t[a][e])return a;if(i===t[n][e])return n;if(i===o)return s;if(i>o?a=s:n=s,2>=r)break}return a}(this._dataList,"timestamp",t)}},{key:"dataIndexToCoordinate",value:function(t){return this._totalDataSpace-(this._dataList.length+this._offsetRightBarCount-t-.5)*this._dataSpace}},{key:"coordinateToDataIndex",value:function(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}},{key:"zoom",value:function(t,e){var i=this;if(this._zoomEnabled){e&&w(e.x)||(e={x:w(this._crosshair.x)?this._crosshair.x:this._totalDataSpace/2}),this.actionExecute(Xt.ZOOM,{point:e,scale:t});var a=this.coordinateToFloatIndex(e.x);this.setDataSpace(this._dataSpace+t*(this._dataSpace/10),(function(){i._offsetRightBarCount+=a-i.coordinateToFloatIndex(e.x)}))}}},{key:"invalidate",value:function(t){this._handler.invalidate(t)}},{key:"setZoomEnabled",value:function(t){this._zoomEnabled=t}},{key:"zoomEnabled",value:function(){return this._zoomEnabled}},{key:"setScrollEnabled",value:function(t){this._scrollEnabled=t}},{key:"scrollEnabled",value:function(){return this._scrollEnabled}},{key:"setLoadMoreCallback",value:function(t){this._loadMoreCallback=t}},{key:"addGraphicMarkInstance",value:function(t){if(this._graphicMarks.find((function(e){return e.id()===t.id()})))return!1;var e=this._graphicMarks[this._graphicMarks.length-1];return e&&e.isDrawing()?this._graphicMarks[this._graphicMarks.length-1]=t:this._graphicMarks.push(t),this.invalidate(Wt),!0}},{key:"addCustomGraphicMark",value:function(t){var e=this;t.forEach((function(t){var i=Rt(t);i&&(e._graphicMarkMapping[t.name]=i)}))}},{key:"setGraphicMarkOptions",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.styles,a=e.lock,n=this._graphicMarks.find((function(e){return e.id()===t}));n&&(n.setLock(a),n.setStyles(i,this._styleOptions.graphicMark)&&this.invalidate(Wt))}},{key:"getGraphicMark",value:function(t){if(!t)return this._graphicMarks.map((function(t){return Bt(t)}));var e=this._graphicMarks.find((function(e){return e.id()===t}));return e?Bt(e):null}},{key:"removeGraphicMarkInstance",value:function(t){var e=this._graphicMarks;if(w(t)){var i=e.findIndex((function(e){return e.id()===t}));i>-1&&(e[i].onRemove({id:e[i].id()}),e.splice(i,1),this.invalidate(Wt))}else e.length>0&&(e.forEach((function(t){t.onRemove({id:t.id()})})),this._graphicMarks=[],this.invalidate(Wt))}},{key:"dragGraphicMarkFlag",value:function(){return this._dragGraphicMarkFlag}},{key:"setDragGraphicMarkFlag",value:function(t){this._dragGraphicMarkFlag=t}},{key:"graphicMarkMouseOperate",value:function(){return this._graphicMarkMouseOperate}},{key:"dragPaneFlag",value:function(){return this._dragPaneFlag}},{key:"setDragPaneFlag",value:function(t){this._dragPaneFlag=t}},{key:"graphicMarkMapping",value:function(){return this._graphicMarkMapping}},{key:"graphicMarks",value:function(){return this._graphicMarks}},{key:"visibleAnnotations",value:function(){return this._visibleAnnotations}},{key:"annotationMouseOperate",value:function(){return this._annotationMouseOperate}},{key:"addAnnotations",value:function(t){var e=this;t.forEach((function(t){e._annotations.has(t.id())?e._annotations.get(t.id()).push(t):e._annotations.set(t.id(),[t])})),this._adjustVisibleDataList(),this.invalidate(Wt)}},{key:"removeAnnotation",value:function(t){var e=this,i=!1;w(t)?([].concat(t).forEach((function(t){var a=t.timestamp;e._annotations.has(a)&&(i=!0,e._annotations.delete(a))})),i&&this._adjustVisibleDataList()):(i=!0,this._annotations.clear(),this._visibleAnnotations=[]),i&&this.invalidate(Wt)}},{key:"tags",value:function(){return this._tags}},{key:"getTag",value:function(t){return this._tags.get(t)}},{key:"addTags",value:function(t){var e=this;t.forEach((function(t){e._tags.set(t.id(),t)})),this.invalidate(Wt)}},{key:"removeTag",value:function(t){var e=this,i=!1;w(t)?[].concat(t).forEach((function(t){e._tags.has(t)&&(i=!0,e._tags.delete(t))})):(i=!0,this._tags.clear());i&&this.invalidate(Wt)}},{key:"setOverlayMouseOperate",value:function(t,e){var i=this._graphicMarkMouseOperate,n=i.hover,s=i.click,r=this._annotationMouseOperate.id,o=this._graphicMarks[this._graphicMarks.length-1],h=!1;!t.hover||n.id===t.hover.id&&n.element===t.hover.element&&n.elementIndex===t.hover.elementIndex||(this._graphicMarkMouseOperate.hover=a({},t.hover),h=!0),!t.click||s.id===t.click.id&&s.element===t.click.element&&s.elementIndex===t.click.elementIndex||(this._graphicMarkMouseOperate.click=a({},t.click),h=!0),e&&r!==e.id&&(this._annotationMouseOperate=a({},e),h=!0),(h||o&&o.isDrawing())&&this.invalidate(Wt)}},{key:"addCustomTechnicalIndicator",value:function(t){var e=this;t.forEach((function(t){var i=ut(t||{});i&&(e._technicalIndicatorMapping[i.name]=i)}))}},{key:"actionExecute",value:function(t,e,i,a){this.hasAction(t)&&(i&&i(),this._actionDelegate.get(t).execute(e),a&&a())}},{key:"hasAction",value:function(t){return this._actionDelegate.has(t)&&this._actionDelegate.get(t).hasObservers()}},{key:"subscribeAction",value:function(t,e){return Object.values(Xt).indexOf(t)>=0&&(this._actionDelegate.has(t)||this._actionDelegate.set(t,new zt),this._actionDelegate.get(t).subscribe(e),!0)}},{key:"unsubscribeAction",value:function(t,e){if(0>Object.values(Xt).indexOf(t))return!1;if(this._actionDelegate.has(t)){var i=this._actionDelegate.get(t);return i.unsubscribe(e),i.hasObservers()||this._actionDelegate.delete(t),!0}return!1}}]),t}();function Zt(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||2}function Ut(t,e){return Math.round(t.measureText(e).width)}function Kt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Helvetica Neue";return"".concat(e," ").concat(t,"px ").concat(i)}var qt=function(){function t(e){s(this,t),this._height=-1,this._container=e.container,this._chartData=e.chartData,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._element,e),this._yAxisWidget=this._createYAxisWidget(this._element,e)}return o(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="relative",this._element.style.overflow="hidden",this._element.style.width="100%";var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"width",value:function(){return this._element.offsetWidth}},{key:"setWidth",value:function(t,e){this._mainWidget.setWidth(t),this._yAxisWidget&&this._yAxisWidget.setWidth(e)}},{key:"height",value:function(){return this._height}},{key:"setHeight",value:function(t){this._height=t,this._mainWidget.setHeight(t),this._yAxisWidget&&this._yAxisWidget.setHeight(t)}},{key:"setOffsetLeft",value:function(t,e){this._mainWidget.setOffsetLeft(t),this._yAxisWidget&&this._yAxisWidget.setOffsetLeft(e)}},{key:"layout",value:function(){this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainWidget.layout(),this._yAxisWidget&&this._yAxisWidget.layout()}},{key:"invalidate",value:function(t){this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"getImage",value:function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=Zt(e),n=this._element.offsetWidth,s=this._element.offsetHeight;e.style.width="".concat(n,"px"),e.style.height="".concat(s,"px"),e.width=n*a,e.height=s*a,i.scale(a,a);var r=this._mainWidget.getElement(),o=r.offsetWidth,h=r.offsetHeight,c=parseInt(r.style.left,10);if(i.drawImage(this._mainWidget.getImage(t),c,0,o,h),this._yAxisWidget){var l=this._yAxisWidget.getElement(),u=l.offsetWidth,d=l.offsetHeight,_=parseInt(l.style.left,10);i.drawImage(this._yAxisWidget.getImage(t),_,0,u,d)}return e}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),$t=function(){function t(e){s(this,t),this._width=0,this._height=0,this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._overlayView=this._createOverlayView(this._element,e)}return o(t,[{key:"_initElement",value:function(t){this._element=document.createElement("div"),this._element.style.top="0",this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="absolute",this._element.style.overflow="hidden",t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createOverlayView",value:function(t,e){}},{key:"getElement",value:function(){return this._element}},{key:"setWidth",value:function(t){this._width=t,this._mainView.setWidth(t),this._overlayView.setWidth(t)}},{key:"setHeight",value:function(t){this._height=t,this._mainView.setHeight(t),this._overlayView.setHeight(t)}},{key:"setOffsetLeft",value:function(t){this._element.style.left="".concat(t,"px")}},{key:"layout",value:function(){this._element.offsetWidth!==this._width&&(this._element.style.width="".concat(this._width,"px")),this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainView.layout(),this._overlayView.layout()}},{key:"invalidate",value:function(t){switch(t){case Wt:this._overlayView.flush();break;case Nt:case Gt:this._mainView.flush(),this._overlayView.flush()}}},{key:"getImage",value:function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=Zt(e);return e.style.width="".concat(this._width,"px"),e.style.height="".concat(this._height,"px"),e.width=this._width*a,e.height=this._height*a,i.scale(a,a),i.drawImage(this._mainView.getImage(),0,0,this._width,this._height),t&&this._overlayView&&i.drawImage(this._overlayView.getImage(),0,0,this._width,this._height),e}}]),t}();function Jt(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,20)}var Qt=function(){function t(e,i){s(this,t),this._chartData=i,this._initCanvas(e)}return o(t,[{key:"_initCanvas",value:function(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._canvas.style.zIndex="2",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"layout",value:function(){var t=this;this._height!==this._canvas.offsetHeight||this._width!==this._canvas.offsetWidth?this._redraw((function(){var e=Zt(t._canvas);t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=Math.floor(t._width*e),t._canvas.height=Math.floor(t._height*e),t._ctx.scale(e,e)})):this.flush()}},{key:"flush",value:function(){var t,e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t),this.requestAnimationId=null),this.requestAnimationId=Jt((function(){e._redraw()}))}},{key:"getImage",value:function(){return this._canvas}}]),t}(),te=function(t){c(i,t);var e=_(i);function i(t,a,n,r,o){var h;return s(this,i),(h=e.call(this,t,a))._xAxis=n,h._yAxis=r,h._additionalDataProvider=o,h}return o(i,[{key:"_draw",value:function(){this._drawGrid(),this._drawTechnicalIndicators()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartData.styleOptions().grid;if(e.show){var i=e.horizontal;this._ctx.save(),i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,this._ctx.setLineDash(i.style===M?i.dashValue:[]),this._yAxis.ticks().forEach((function(e){mt(t._ctx,e.y,0,t._width)})));var a=e.vertical;a.show&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,this._ctx.setLineDash(a.style===M?a.dashValue:[]),this._xAxis.ticks().forEach((function(e){xt(t._ctx,e.x,0,t._height)}))),this._ctx.restore()}}},{key:"_drawTechnicalIndicators",value:function(){var t=this,e=this._chartData.styleOptions().technicalIndicator;this._additionalDataProvider.technicalIndicators().forEach((function(i){var n=i.plots,s=[],r=t._chartData.dataList(),o=i.result,h=i.styles||e;i.render&&(t._ctx.save(),i.render(t._ctx,{from:t._chartData.from(),to:t._chartData.to(),kLineDataList:t._chartData.dataList(),technicalIndicatorDataList:o},{width:t._width,height:t._height,dataSpace:t._chartData.dataSpace(),barSpace:t._chartData.barSpace()},h,{convertFromPixel:t._xAxis.convertFromPixel.bind(t._xAxis),convertToPixel:t._xAxis.convertToPixel.bind(t._xAxis)},{convertFromPixel:t._yAxis.convertFromPixel.bind(t._yAxis),convertToPixel:t._yAxis.convertToPixel.bind(t._yAxis)},t._yAxis.isCandleYAxis()),t._ctx.restore());var c=i.baseValue;w(c)||(c=t._yAxis.min());var l=t._yAxis.convertToPixel(c),u=t._yAxis.isCandleYAxis();t._ctx.lineWidth=1,t._drawGraphics((function(e,c,d,_,v){var f=o[c]||{},p=0;i.shouldOhlc&&!u&&t._drawCandleBar(e,_,v,c,d,h.bar,R);var y={};n.forEach((function(n){var m=f[n.key],x=t._yAxis.convertToPixel(m);switch(y[n.key]=x,n.type){case ct:if(w(m)){var g={preData:{kLineData:r[c-1],technicalIndicatorData:o[c-1]},currentData:{kLineData:d,technicalIndicatorData:f},nextData:{kLineData:r[c+1],technicalIndicatorData:o[c+1]}},k={x:e,y:x,radius:_,color:n.color&&n.color(g,h)||h.circle.noChangeColor,isStroke:!n.isStroke||n.isStroke(g)};t._drawCircle(k)}break;case ht:if(w(m)){var D={preData:{kLineData:r[c-1],technicalIndicatorData:o[c-1]},currentData:{kLineData:d,technicalIndicatorData:f},nextData:{kLineData:r[c+1],technicalIndicatorData:o[c+1]}},b=Math.abs(l-x),P={x:e-_,width:2*_,height:Math.max(1,b)};P.y=x>l?l:1>b?l-1:x,P.color=n.color&&n.color(D,h)||h.bar.noChangeColor,P.isStroke=!!n.isStroke&&n.isStroke(D),t._drawBar(P)}break;case ot:var E=null;w(m)&&(E={x:e,y:x}),s[p]?s[p].push(E):s[p]=[E],p++}t._drawActionExecute(Xt.DRAW_TECHNICAL_INDICATOR,{ctx:t._ctx,kLineData:d,dataIndex:c,technicalIndicatorData:f,technicalIndicatorName:i.name,coordinate:a({x:e},y),viewport:{width:t._width,height:t._height},barSpace:v,halfBarSpace:_,isCandle:u})}))}),(function(){t._drawLines(s,h)}))}))}},{key:"_drawGraphics",value:function(t,e){var i=this._chartData.visibleDataList(),a=this._chartData.barSpace(),n=a/2;i.forEach((function(e,i){t(e.x,e.index,e.data,n,a,i)})),e&&e()}},{key:"_drawLines",value:function(t,e){var i=this,a=e.line.colors||[],n=a.length;this._ctx.lineWidth=e.line.size,gt(this._ctx,(function(){t.forEach((function(t,e){i._ctx.strokeStyle=a[e%n],i._ctx.beginPath();var s=!0;t.forEach((function(t){w(t)&&(s?(i._ctx.moveTo(t.x,t.y),s=!1):i._ctx.lineTo(t.x,t.y))})),i._ctx.stroke(),i._ctx.closePath()}))}))}},{key:"_drawBar",value:function(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value:function(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawCandleBar",value:function(t,e,i,a,n,s,r){var o=n.open,h=n.close,c=n.high,l=n.low;h>o?(this._ctx.strokeStyle=s.upColor,this._ctx.fillStyle=s.upColor):o>h?(this._ctx.strokeStyle=s.downColor,this._ctx.fillStyle=s.downColor):(this._ctx.strokeStyle=s.noChangeColor,this._ctx.fillStyle=s.noChangeColor);var u=this._yAxis.convertToPixel(o),d=this._yAxis.convertToPixel(h),_=this._yAxis.convertToPixel(c),v=this._yAxis.convertToPixel(l),f=Math.min(u,d),p=Math.max(u,d);this._ctx.fillRect(t-.5,_,1,f-_),this._ctx.fillRect(t-.5,p,1,v-p);var y=Math.max(1,p-f);switch(r){case L:this._ctx.fillRect(t-e,f,i,y);break;case O:this._ctx.strokeRect(t-e+.5,f,i-1,y);break;case F:h>o?this._ctx.strokeRect(t-e+.5,f,i-1,y):this._ctx.fillRect(t-e,f,i,y);break;case z:h>o?this._ctx.fillRect(t-e,f,i,y):this._ctx.strokeRect(t-e+.5,f,i-1,y);break;default:this._ctx.fillRect(t-.5,_,1,v-_),this._ctx.fillRect(t-e,u-.5,e,1),this._ctx.fillRect(t,d-.5,e,1)}this._drawActionExecute(Xt.DRAW_CANDLE,{ctx:this._ctx,dataIndex:a,kLineData:n,coordinate:{x:t,open:u,close:d,high:_,low:v},viewport:{width:this._width,height:this._height},barSpace:i,halfBarSpace:e,isCandle:this._yAxis.isCandleYAxis()})}},{key:"_drawActionExecute",value:function(t,e){var i=this;this._chartData.actionExecute(t,e,(function(){i._ctx.save()}),(function(){i._ctx.restore()}))}}]),i}(Qt);function ee(t,e,i,a,n){t.fillStyle=e,t.fillText(n,i,a)}var ie=function(t){c(i,t);var e=_(i);function i(t,a,n,r,o){var h;return s(this,i),(h=e.call(this,t,a))._xAxis=n,h._yAxis=r,h._additionalDataProvider=o,h}return o(i,[{key:"_draw",value:function(){this._drawCover();var t=this._chartData.crosshair();if(t.kLineData){var e=this._additionalDataProvider.technicalIndicators(),i=this._chartData.styleOptions().crosshair;t.paneId===this._additionalDataProvider.id()&&this._drawCrosshairLine(i,"horizontal",t.y,0,this._width,mt),t.paneId&&this._drawCrosshairLine(i,"vertical",t.realX,0,this._height,xt),this._drawTooltip(t,e)}}},{key:"_drawCover",value:function(){}},{key:"_drawTooltip",value:function(t,e){var i=this._chartData.styleOptions().technicalIndicator;this._drawBatchTechnicalIndicatorToolTip(t,e,i,0,this._shouldDrawTooltip(t,i.tooltip))}},{key:"_drawCrosshairLine",value:function(t,e,i,a,n,s){var r=t[e],o=r.line;t.show&&r.show&&o.show&&(this._ctx.save(),this._ctx.lineWidth=o.size,this._ctx.strokeStyle=o.color,o.style===M&&this._ctx.setLineDash(o.dashValue),s(this._ctx,i,a,n),this._ctx.restore())}},{key:"_drawBatchTechnicalIndicatorToolTip",value:function(t,e,i){var a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;if(s){var r=i.tooltip,o=n;e.forEach((function(e){a._drawTechnicalIndicatorTooltip(t,e,i,o),o+=r.text.marginTop+r.text.size+r.text.marginBottom}))}}},{key:"_drawTechnicalIndicatorTooltip",value:function(t,e,i){var a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=i.tooltip,r=e.styles||i,o=e.result,h=o[t.dataIndex],c=_t(h,e),l=r.line.colors,u=this._chartData.dataList(),d={preData:{kLineData:u[t.dataIndex-1],technicalIndicatorData:o[t.dataIndex-1]},currentData:{kLineData:u[t.dataIndex],technicalIndicatorData:h},nextData:{kLineData:u[t.dataIndex+1],technicalIndicatorData:o[t.dataIndex+1]}},_=e.plots,v=s.text,f=c.values,p=v.marginLeft,y=v.marginRight,m=0,x=v.marginTop+n,g=v.size,k=v.color,D=l.length;if(this._ctx.textBaseline="top",this._ctx.font=Kt(g,v.weight,v.family),s.showName){var b=c.name,P=Ut(this._ctx,b);ee(this._ctx,k,m+=p,x,b),m+=P,s.showParams||(m+=y)}if(s.showParams){var E=c.calcParamText,M=Ut(this._ctx,E);s.showName||(m+=p),ee(this._ctx,k,m,x,E),m+=M+y}var C,T=0;_.forEach((function(t,e){switch(t.type){case ct:C=t.color&&t.color(d,r)||r.circle.noChangeColor;break;case ht:C=t.color&&t.color(d,r)||r.bar.noChangeColor;break;case ot:C=l[T%D]||k,T++}var i=f[e].title;if(w(i)){m+=p;var n="".concat(i).concat(f[e].value||s.defaultValue),o=Ut(a._ctx,n);ee(a._ctx,C,m,x,n),m+=o+y}}))}},{key:"_shouldDrawTooltip",value:function(t,e){var i=e.showRule;return i===H||i===V&&!!t.paneId}}]),i}(Qt),ae=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_createMainView",value:function(t,e){return new te(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createOverlayView",value:function(t,e){return new ie(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}}]),i}($t);function ne(t,e,i,a,n,s,r,o,h){re(t,e,n,s,r,o,h),se(t,i,a,n,s,r,o,h)}function se(t,e,i,a,n,s,r,o){t.lineWidth=i,t.strokeStyle=e,oe(t,a,n,s,r,o),t.stroke()}function re(t,e,i,a,n,s,r){t.fillStyle=e,oe(t,i,a,n,s,r),t.fill()}function oe(t,e,i,a,n,s){t.beginPath(),t.moveTo(e+s,i),t.arcTo(e+a,i,e+a,i+n,s),t.arcTo(e+a,i+n,e,i+n,s),t.arcTo(e,i+n,e,i,s),t.arcTo(e,i,e+a,i,s),t.closePath()}var he=function(t){c(i,t);var e=_(i);function i(t,a,n,r){var o;return s(this,i),(o=e.call(this,t,a))._yAxis=n,o._additionalDataProvider=r,o}return o(i,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().yAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechnicalIndicatorLastValue(t),this._drawLastPriceLabel(t))}},{key:"_drawAxisLine",value:function(t){var e,i=t.axisLine;i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,e=this._yAxis.isFromYAxisZero()?0:this._width-1,xt(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a,n,s=i.length;this._yAxis.isFromYAxisZero()?(a=0,t.axisLine.show&&(a+=t.axisLine.size),n=a+s):(a=this._width,t.axisLine.show&&(a-=t.axisLine.size),n=a-s),this._yAxis.ticks().forEach((function(t){mt(e._ctx,t.y,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=this,i=t.tickText;if(i.show){var a,n=t.tickLine,s=n.show,r=n.length;this._yAxis.isFromYAxisZero()?(a=i.paddingLeft,t.axisLine.show&&(a+=t.axisLine.size),s&&(a+=r),this._ctx.textAlign="left"):(a=this._width-i.paddingRight,t.axisLine.show&&(a-=t.axisLine.size),s&&(a-=r),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=Kt(i.size,i.weight,i.family),this._ctx.fillStyle=i.color,this._yAxis.ticks().forEach((function(t){e._ctx.fillText(t.v,a,t.y)})),this._ctx.textAlign="left"}}},{key:"_drawTechnicalIndicatorLastValue",value:function(t){var e=this,i=this._chartData.styleOptions().technicalIndicator,n=i.lastValueMark,s=this._additionalDataProvider.technicalIndicators();if(n.show&&n.text.show){var r=this._chartData.dataList();s.forEach((function(s){var o=s.result||[],h=o.length,c=o[h-1]||{},l={preData:{kLineData:r[h-2],technicalIndicatorData:o[h-2]},currentData:{kLineData:r[h-1],technicalIndicatorData:c},nextData:{kLineData:null,technicalIndicatorData:null}},u=s.precision,d=s.styles||i,_=d.line.colors||[],v=_.length,f=0;s.plots.forEach((function(i){var r,o=c[i.key];switch(i.type){case ct:r=i.color&&i.color(l,d)||d.circle.noChangeColor;break;case ht:r=i.color&&i.color(l,d)||d.bar.noChangeColor;break;case ot:r=_[f%v],f++}w(o)&&e._drawMarkLabel(t,o,u,s.shouldFormatBigNumber,a(a({},n.text),{},{backgroundColor:r}))}))}))}}},{key:"_drawLastPriceLabel",value:function(t){if(this._yAxis.isCandleYAxis()){var e=this._chartData.styleOptions().candle.priceMark,i=e.last;if(e.show&&i.show&&i.text.show){var n=this._chartData.dataList(),s=n[n.length-1];if(s){var r,o=s.close,h=s.open;r=o>h?i.upColor:h>o?i.downColor:i.noChangeColor,this._drawMarkLabel(t,o,this._chartData.pricePrecision(),!1,a(a({},i.text),{},{backgroundColor:r}))}}}}},{key:"_drawMarkLabel",value:function(t,e,i,a,n){var s,r=n.size,o=n.weight,h=n.family,c=n.color,l=n.backgroundColor,u=n.borderRadius,d=n.paddingLeft,_=n.paddingTop,v=n.paddingRight,f=n.paddingBottom,p=this._yAxis.convertToNicePixel(e);if(this._yAxis.yAxisType()===S){var y=((this._chartData.visibleDataList()[0]||{}).data||{}).close;s="".concat(((e-y)/y*100).toFixed(2),"%")}else s=tt(e,i),a&&(s=et(s));this._ctx.font=Kt(r,o,h);var m,x=Ut(this._ctx,s)+d+v,g=_+r+f;m=this._yAxis.isFromYAxisZero()?0:this._width-x,re(this._ctx,l,m,p-_-r/2,x,g,u),this._ctx.textBaseline="middle",ee(this._ctx,c,m+d,p,s)}}]),i}(Qt),ce=function(t){c(i,t);var e=_(i);function i(t,a,n,r){var o;return s(this,i),(o=e.call(this,t,a))._yAxis=n,o._additionalDataProvider=r,o}return o(i,[{key:"_draw",value:function(){var t=this;(this._ctx.textBaseline="middle",this._yAxis.isCandleYAxis())&&this._chartData.tags().forEach((function(e){e.drawText(t._ctx)}));this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value:function(){var t=this._chartData.crosshair();if(t.paneId===this._additionalDataProvider.id()&&0!==this._chartData.dataList().length){var e=this._chartData.styleOptions().crosshair,i=e.horizontal,a=i.text;if(e.show&&i.show&&a.show){var n,s=this._yAxis.convertFromPixel(t.y);if(this._yAxis.yAxisType()===S){var r=(this._chartData.visibleDataList()[0]||{}).data||{};n="".concat(((s-r.close)/r.close*100).toFixed(2),"%")}else{var o=this._additionalDataProvider.technicalIndicators(),h=0,c=!1;this._yAxis.isCandleYAxis()?h=this._chartData.pricePrecision():o.forEach((function(t){h=Math.max(t.precision,h),c||(c=t.shouldFormatBigNumber)})),n=tt(s,h),c&&(n=et(n))}var l=a.size;this._ctx.font=Kt(l,a.weight,a.family);var u,d=Ut(this._ctx,n),_=a.paddingLeft,v=a.paddingTop,f=a.borderSize,p=d+2*f+_+a.paddingRight,y=l+2*f+v+a.paddingBottom;u=this._yAxis.isFromYAxisZero()?0:this._width-p,ne(this._ctx,a.backgroundColor,a.borderColor,f,u,t.y-f-v-l/2,p,y,a.borderRadius),ee(this._ctx,a.color,u+f+_,t.y,n)}}}}]),i}(Qt),le=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_createMainView",value:function(t,e){return new he(t,e.chartData,e.yAxis,e.additionalDataProvider)}},{key:"_createOverlayView",value:function(t,e){return new ce(t,e.chartData,e.yAxis,e.additionalDataProvider)}}]),i}($t),ue=function(){function t(e){s(this,t),this._chartData=e,this._width=0,this._height=0,this._cacheMinValue=0,this._cacheMaxValue=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[],this._initMeasureCanvas()}return o(t,[{key:"_initMeasureCanvas",value:function(){var t=document.createElement("canvas"),e=Zt(t);this._measureCtx=t.getContext("2d"),this._measureCtx.scale(e,e)}},{key:"min",value:function(){return this._minValue}},{key:"max",value:function(){return this._maxValue}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(t){var e=this._optimalMinMax(this._computeMinMax());return this._minValue=e.min,this._maxValue=e.max,this._range=e.range,!(this._cacheMinValue===e.min&&this._cacheMaxValue===e.max&&!t)&&(this._cacheMinValue=e.min,this._cacheMaxValue=e.max,this._ticks=this._optimalTicks(this._computeTicks()),!0)}},{key:"_computeMinMax",value:function(){}},{key:"_optimalMinMax",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=this._computeInterval(this._range),i=e.interval,a=e.precision,n=it(Math.ceil(this._minValue/i)*i,a),s=it(Math.floor(this._maxValue/i)*i,a),r=0,o=n;if(0!==i)for(;s>=o;)t[r]={v:o.toFixed(a)},++r,o+=i}return t}},{key:"_optimalTicks",value:function(t){}},{key:"_computeInterval",value:function(t){var e,i,a,n,s=(i=Math.floor(at(e=t/8)),a=nt(i),e=(1.5>(n=e/a)?1:2.5>n?2:3.5>n?3:4.5>n?4:5.5>n?5:6.5>n?6:8)*a,-20>i?e:+e.toFixed(0>i?-i:0));return{interval:s,precision:function(t){var e=""+t,i=e.indexOf("e");if(i>0){var a=+e.slice(i+1);return 0>a?-a:0}var n=e.indexOf(".");return 0>n?0:e.length-1-n}(s)}}}]),t}(),de=function(t){c(i,t);var e=_(i);function i(t,a,n){var r;return s(this,i),(r=e.call(this,t))._realRange=0,r._isCandleYAxis=a,r._additionalDataProvider=n,r}return o(i,[{key:"_computeMinMax",value:function(){var t=this,e=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],i=[],a=!1,n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER;this._additionalDataProvider.technicalIndicators().forEach((function(t){a||(a=t.shouldOhlc),r=Math.min(r,t.precision),D(t.minValue)&&(n=Math.min(n,t.minValue)),D(t.maxValue)&&(s=Math.max(s,t.maxValue)),i.push({plots:t.plots,result:t.result})}));var o=4;if(this._isCandleYAxis){var h=this._chartData.pricePrecision();o=r!==Number.MAX_SAFE_INTEGER?Math.min(r,h):h}else r!==Number.MAX_SAFE_INTEGER&&(o=r);var c=this._chartData.visibleDataList(),l=this._chartData.styleOptions().candle,u=l.type===B,d=l.area.value,_=this._isCandleYAxis&&!u||!this._isCandleYAxis&&a;return c.forEach((function(a){var n=a.index,s=a.data;_&&(e[0]=Math.min(e[0],s.low),e[1]=Math.max(e[1],s.high)),t._isCandleYAxis&&u&&(e[0]=Math.min(e[0],s[d]),e[1]=Math.max(e[1],s[d])),i.forEach((function(t){var i=t.result[n]||{};t.plots.forEach((function(t){var a=i[t.key];w(a)&&(e[0]=Math.min(e[0],a),e[1]=Math.max(e[1],a))}))}))})),e[0]!==Number.MAX_SAFE_INTEGER&&e[1]!==Number.MIN_SAFE_INTEGER?(e[0]=Math.min(n,e[0]),e[1]=Math.max(s,e[1])):(e[0]=0,e[1]=10),{min:e[0],max:e[1],precision:o,specifyMin:n,specifyMax:s}}},{key:"_optimalMinMax",value:function(t){var e,i,a,n,s=t.precision,r=t.specifyMin,o=t.specifyMax,h=t.min,c=t.max,l=this.yAxisType();switch(l){case S:var u=(this._chartData.visibleDataList()[0]||{}).data||{};D(u.close)&&(h=(h-u.close)/u.close*100,c=(c-u.close)/u.close*100),e=.01;break;case I:h=at(h),c=at(c),e=.05*nt(-s);break;default:e=nt(-s)}if(h===c||e>Math.abs(h-c)){var d=r===h,_=o===c;h=d?h:_?h-8*e:h-4*e,c=_?c:d?c+8*e:c+4*e}a=(i=this._isCandleYAxis?this._chartData.styleOptions().candle.margin:this._chartData.styleOptions().technicalIndicator.margin).top>1?i.top/this._height:D(i.top)?i.top:.2,n=i.bottom>1?i.bottom/this._height:D(i.bottom)?i.bottom:.1;var v=Math.abs(c-h);return v=Math.abs((c+=v*a)-(h-=v*n)),this._realRange=l===I?Math.abs(nt(c)-nt(h)):v,{min:h,max:c,range:v}}},{key:"_optimalTicks",value:function(t){var e=this,i=[],a=this.yAxisType(),n=this._additionalDataProvider.technicalIndicators(),s=0,r=!1;this._isCandleYAxis?s=this._chartData.pricePrecision():n.forEach((function(t){s=Math.max(s,t.precision),r||(r=t.shouldFormatBigNumber)}));var o,h,c=this._chartData.styleOptions().xAxis.tickText.size;return a===I&&(o=this._computeInterval(this._realRange)),t.forEach((function(t){var n,l=t.v,u=e._innerConvertToPixel(+l);switch(a){case S:n="".concat(tt(l,2),"%");break;case I:n=it(nt(l),o.precision),u=e._innerConvertToPixel(at(n)),n=tt(n,s);break;default:n=tt(l,s),r&&(n=et(n))}u>c&&e._height-c>u&&(h&&h-u>2*c||!h)&&(i.push({v:n,y:u}),h=u)})),i}},{key:"_innerConvertToPixel",value:function(t){return Math.round((1-(t-this._minValue)/this._range)*this._height)}},{key:"isCandleYAxis",value:function(){return this._isCandleYAxis}},{key:"yAxisType",value:function(){return this._isCandleYAxis?this._chartData.styleOptions().yAxis.type:A}},{key:"isFromYAxisZero",value:function(){var t=this._chartData.styleOptions().yAxis;return t.position===C&&t.inside||t.position===T&&!t.inside}},{key:"getSelfWidth",value:function(){var t=this,e=this._chartData.styleOptions(),i=e.yAxis,a=i.width;if(D(a))return a;var n=0;if(i.show&&(i.axisLine.show&&(n+=i.axisLine.size),i.tickLine.show&&(n+=i.tickLine.length),i.tickText.show)){var s=0;this._measureCtx.font=Kt(i.tickText.size,i.tickText.weight,i.tickText.family),this._ticks.forEach((function(e){s=Math.max(s,Ut(t._measureCtx,e.v))})),n+=i.tickText.paddingLeft+i.tickText.paddingRight+s}var r=e.crosshair,o=0;if(r.show&&r.horizontal.show&&r.horizontal.text.show){var h=this._additionalDataProvider.technicalIndicators(),c=0,l=!1;h.forEach((function(t){c=Math.max(t.precision,c),l||(l=t.shouldFormatBigNumber)})),this._measureCtx.font=Kt(r.horizontal.text.size,r.horizontal.text.weight,r.horizontal.text.family);var u=2;if(this.yAxisType()!==S)if(this._isCandleYAxis){var d=this._chartData.pricePrecision(),_=e.technicalIndicator.lastValueMark;u=_.show&&_.text.show?Math.max(c,d):d}else u=c;var v=tt(this._maxValue,u);l&&(v=et(v)),o+=r.horizontal.text.paddingLeft+r.horizontal.text.paddingRight+2*r.horizontal.text.borderSize+Ut(this._measureCtx,v)}return Math.max(n,o)}},{key:"convertFromPixel",value:function(t){var e=(1-t/this._height)*this._range+this._minValue;switch(this.yAxisType()){case S:var i=(this._chartData.visibleDataList()[0]||{}).data||{};if(D(i.close))return i.close*e/100+i.close;break;case I:return nt(e);default:return e}}},{key:"convertToPixel",value:function(t){var e;switch(this.yAxisType()){case S:var i=(this._chartData.visibleDataList()[0]||{}).data||{};D(i.close)&&(e=(t-i.close)/i.close*100);break;case I:e=at(t);break;default:e=t}return this._innerConvertToPixel(e)}},{key:"convertToNicePixel",value:function(t){var e=this.convertToPixel(t);return Math.round(Math.max(.05*this._height,Math.min(e,.98*this._height)))}}]),i}(ue),_e=function(t){c(i,t);var e=_(i);function i(t){var a;return s(this,i),(a=e.call(this,t))._techs=new Map,"height"in t&&a.setHeight(t.height),a.setTechnicalIndicator(a._chartData.getTechnicalIndicatorInstance(t.name)),a}return o(i,[{key:"_initBefore",value:function(t){this._id=t.id,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new de(t.chartData,!1,{technicalIndicators:this.technicalIndicators.bind(this)})}},{key:"_createMainWidget",value:function(t,e){return new ae({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}},{key:"_createYAxisWidget",value:function(t,e){return new le({container:t,chartData:e.chartData,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}},{key:"setHeight",value:function(t){v(l(i.prototype),"setHeight",this).call(this,t),this._yAxis.setHeight(t)}},{key:"setWidth",value:function(t,e){v(l(i.prototype),"setWidth",this).call(this,t,e),this._yAxis.setWidth(e)}},{key:"id",value:function(){return this._id}},{key:"yAxis",value:function(){return this._yAxis}},{key:"technicalIndicators",value:function(){return this._techs}},{key:"isEmptyTechnicalIndicator",value:function(){return 0===this._techs.size}},{key:"removeTechnicalIndicator",value:function(t){return t?!!this._techs.has(t)&&(this._techs.delete(t),!0):(this._techs.clear(),!0)}},{key:"setTechnicalIndicator",value:function(t,e){if(t){if(this._techs.has(t.name))return!1;var i=Object.create(t);return e?this._techs.set(i.name,i):this._techs=new Map([[i.name,i]]),this.calcTechnicalIndicator(i),!0}return!1}},{key:"calcTechnicalIndicator",value:function(t){t.result=t.calcTechnicalIndicator(this._chartData.dataList(),t.calcParams,t.plots)||[]}},{key:"calcAllTechnicalIndicator",value:function(){var t=this;return this._techs.forEach((function(e){t.calcTechnicalIndicator(e)})),this._yAxis.computeAxis()}}]),i}(qt),ve=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_draw",value:function(){this._drawGrid();var t=this._chartData.styleOptions().candle;t.type===B?this._drawArea(t):(this._drawCandle(t),this._drawLowHighPrice(t.priceMark,"high","high",Number.MIN_SAFE_INTEGER,[-2,-5],(function(t,e){if(t>e)return t})),this._drawLowHighPrice(t.priceMark,"low","low",Number.MAX_SAFE_INTEGER,[2,5],(function(t,e){if(e>t)return t}))),this._drawTechnicalIndicators(),this._drawLastPriceLine(t.priceMark)}},{key:"_drawArea",value:function(t){var e=this,i=[],a=[],n=Number.MAX_SAFE_INTEGER,s=t.area;this._drawGraphics((function(t,r,o,h,c,l){var u=o[s.value];if(D(u)){var d=e._yAxis.convertToPixel(u);if(0===l){var _=t-h;a.push({x:_,y:e._height}),a.push({x:_,y:d}),i.push({x:_,y:d})}i.push({x:t,y:d}),a.push({x:t,y:d}),n=Math.min(n,d)}}),(function(){var t=a.length;if(t>0){var r=a[t-1],o=e._chartData.barSpace()/2,h=r.x+o;i.push({x:h,y:r.y}),a.push({x:h,y:r.y}),a.push({x:h,y:e._height})}if(i.length>0&&(e._ctx.lineWidth=s.lineSize,e._ctx.strokeStyle=s.lineColor,gt(e._ctx,(function(){e._ctx.beginPath(),e._ctx.moveTo(i[0].x,i[0].y);for(var t=1;i.length>t;t++)e._ctx.lineTo(i[t].x,i[t].y);e._ctx.stroke(),e._ctx.closePath()}))),a.length>0){var c=s.fillColor;if(x(c)){var l=e._ctx.createLinearGradient(0,e._height,0,n);try{c.forEach((function(t){l.addColorStop(t.offset,t.color)}))}catch(t){}e._ctx.fillStyle=l}else e._ctx.fillStyle=c;e._ctx.beginPath(),e._ctx.moveTo(a[0].x,a[0].y);for(var u=1;a.length>u;u++)e._ctx.lineTo(a[u].x,a[u].y);e._ctx.closePath(),e._ctx.fill()}}))}},{key:"_drawCandle",value:function(t){var e=this;this._drawGraphics((function(i,a,n,s,r){e._drawCandleBar(i,s,r,a,n,t.bar,t.type)}))}},{key:"_drawLowHighPrice",value:function(t,e,i,a,n,s){var r=this,o=t[e];if(t.show&&o.show){var h=this._chartData.visibleDataList(),c=a,l=-1;h.forEach((function(t){var e=t.index,n=s(J(t.data,i,a),c);n&&(c=n,l=e)}));var u=this._chartData.pricePrecision(),d=this._yAxis.convertToPixel(c),_=this._xAxis.convertToPixel(l),v=d+n[0];this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=o.color,this._ctx.fillStyle=o.color,gt(this._ctx,(function(){r._ctx.beginPath(),r._ctx.moveTo(_-2,v+n[0]),r._ctx.lineTo(_,v),r._ctx.lineTo(_+2,v+n[0]),r._ctx.stroke(),r._ctx.closePath()}));var f=v+n[1];gt(this._ctx,(function(){r._ctx.beginPath(),r._ctx.moveTo(_,v),r._ctx.lineTo(_,f),r._ctx.lineTo(_+5,f),r._ctx.stroke(),r._ctx.closePath()})),this._ctx.font=Kt(o.textSize,o.textWeight,o.textFamily);var p=tt(c,u);this._ctx.textBaseline="middle",this._ctx.fillText(p,_+5+o.textMargin,f)}}},{key:"_drawLastPriceLine",value:function(t){var e=t.last;if(t.show&&e.show&&e.line.show){var i=this._chartData.dataList(),a=i[i.length-1];if(a){var n,s=a.close,r=a.open,o=this._yAxis.convertToNicePixel(s);n=s>r?e.upColor:r>s?e.downColor:e.noChangeColor,this._ctx.save(),this._ctx.strokeStyle=n,this._ctx.lineWidth=e.line.size,e.line.style===M&&this._ctx.setLineDash(e.line.dashValue),mt(this._ctx,o,0,this._width),this._ctx.restore()}}}}]),i}(te),fe=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_drawCover",value:function(){var t=this;this._ctx.textBaseline="alphabetic",this._chartData.tags().forEach((function(e){e.drawMarkLine(t._ctx)})),this._chartData.graphicMarks().forEach((function(e){e.draw(t._ctx)})),this._chartData.visibleAnnotations().forEach((function(e){e.draw(t._ctx)}))}},{key:"_drawTooltip",value:function(t,e){var i=this._chartData.styleOptions(),a=i.candle,n=a.tooltip,s=i.technicalIndicator,r=s.tooltip,o=this._shouldDrawTooltip(t,n),h=this._shouldDrawTooltip(t,r);n.showType===Y&&r.showType===Y?this._drawCandleTooltipWithRect(t,e,a,o,s,h):n.showType===W?(this._drawCandleTooltipWithStandard(t.kLineData,a,o),r.showType===W?this._drawBatchTechnicalIndicatorToolTip(t,e,s,o?n.text.size+n.text.marginTop:0,h):this._drawCandleTooltipWithRect(t,e,a,!1,s,h)):(this._drawCandleTooltipWithRect(t,e,a,o,s,!1),this._drawBatchTechnicalIndicatorToolTip(t,e,s,0,h))}},{key:"_drawCandleTooltipWithStandard",value:function(t,e,i){var a=this;if(i){var n=this._getCandleTooltipData(t,e),s=e.tooltip,r=s.text.marginLeft,o=s.text.marginRight,h=s.text.size,c=s.text.color,l=s.labels;this._ctx.textBaseline="top",this._ctx.font=Kt(h,s.text.weight,s.text.family);var u=r,d=s.text.marginTop;l.forEach((function(t,e){var i=Ut(a._ctx,t);ee(a._ctx,c,u,d,t),u+=i;var h,l,_=n[e]||s.defaultValue;k(_)?(h=_.value||s.defaultValue,l=_.color||c):(l=c,h=_);var v=Ut(a._ctx,h);ee(a._ctx,l,u,d,h),u+=v+r+o}))}}},{key:"_drawCandleTooltipWithRect",value:function(t,e,i,a,n,s){var r=this;if(a||s){var o=i.tooltip,h=o.labels,c=this._getCandleTooltipData(t.kLineData,i),l=o.text.marginLeft,u=o.text.marginRight,d=o.text.marginTop,_=o.text.marginBottom,v=o.text.size,f=o.text.color,p=o.rect,y=p.borderSize,m=p.paddingLeft,x=p.paddingRight,g=p.paddingTop,D=p.paddingBottom,b=p.offsetLeft,P=p.offsetRight,E=0,M=0,C=0;this._ctx.save(),this._ctx.textBaseline="top",a&&(this._ctx.font=Kt(v,o.text.weight,o.text.family),h.forEach((function(t,e){var i,a=c[e];i=k(a)?a.value||o.defaultValue:a;var n="".concat(t).concat(i),s=Ut(r._ctx,n)+l+u;E=Math.max(E,s)})),C+=(_+d+v)*h.length);var T=n.tooltip,A=T.text.marginLeft,S=T.text.marginRight,I=T.text.marginTop,L=T.text.marginBottom,O=T.text.size,F=[],z=this._chartData.dataList();if(e.forEach((function(e){var i=e.result;F.push({name:e.name,tooltipData:_t(i[t.dataIndex],e),cbData:{preData:{kLineData:z[t.dataIndex-1],technicalIndicatorData:i[t.dataIndex-1]},currentData:{kLineData:z[t.dataIndex],technicalIndicatorData:i[t.dataIndex]},nextData:{kLineData:z[t.dataIndex+1],technicalIndicatorData:i[t.dataIndex+1]}}})})),s&&(this._ctx.font=Kt(O,T.text.weight,T.text.family),F.forEach((function(t){t.tooltipData.values.forEach((function(t){var e=t.title,i=t.value;if(w(e)){var a=i||T.defaultValue,n="".concat(e).concat(a),s=Ut(r._ctx,n)+A+S;E=Math.max(E,s),C+=I+L+O}}))}))),0!==(M+=E)&&0!==C){var R;M+=2*y+m+x;var B=p.offsetTop,H=p.borderRadius;re(this._ctx,p.fillColor,R=this._width/2>t.realX?this._width-P-M:b,B,M,C+=2*y+g+D,H),se(this._ctx,p.borderColor,y,R,B,M,C,H);var V=R+y+m+l,Y=B+y+g;if(a&&(this._ctx.font=Kt(v,o.text.weight,o.text.family),h.forEach((function(t,e){Y+=d,r._ctx.textAlign="left",ee(r._ctx,f,V,Y,t);var i,a,n=c[e];k(n)?(a=n.color||f,i=n.value||o.defaultValue):(a=f,i=n||o.defaultValue),r._ctx.textAlign="right",ee(r._ctx,a,R+M-y-u-x,Y,i),Y+=v+_}))),s){var W=this._chartData.styleOptions().technicalIndicator,N=R+y+m+A;this._ctx.font=Kt(O,T.text.weight,T.text.family),F.forEach((function(t){var i,a=t.tooltipData,n=t.cbData,s=e.get(t.name),o=s.styles||W,h=o.line.colors,c=h.length,l=0;s.plots.forEach((function(t,e){switch(t.type){case ct:i=t.color&&t.color(n,o)||o.circle.noChangeColor;break;case ht:i=t.color&&t.color(n,o)||o.bar.noChangeColor;break;case ot:i=h[l%c]||o.text.color,l++}var s=a.values[e];w(s.title)&&(Y+=I,r._ctx.textAlign="left",r._ctx.fillStyle=i,r._ctx.fillText("".concat(s.title),N,Y),r._ctx.textAlign="right",r._ctx.fillText(s.value||T.defaultValue,R+M-y-S-x,Y),Y+=O+L)}))}))}this._ctx.restore()}}}},{key:"_getCandleTooltipData",value:function(t,e){var i=this,a=e.tooltip.values,n=[];if(a)g(a)?n=a(t,e)||[]:x(a)&&(n=a);else{var s=this._chartData.pricePrecision(),r=this._chartData.volumePrecision();(n=[J(t,"timestamp"),J(t,"open"),J(t,"close"),J(t,"high"),J(t,"low"),J(t,"volume")]).forEach((function(t,e){switch(e){case 0:n[e]=Q(i._chartData.dateTimeFormat(),t,"YYYY-MM-DD hh:mm");break;case n.length-1:n[e]=et(tt(t,r));break;default:n[e]=tt(t,s)}}))}return n}}]),i}(ie),pe=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_createMainView",value:function(t,e){return new ve(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createOverlayView",value:function(t,e){return new fe(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}}]),i}(ae),ye=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_createYAxis",value:function(t){return new de(t.chartData,!0,{technicalIndicators:this.technicalIndicators.bind(this)})}},{key:"_createMainWidget",value:function(t,e){return new pe({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}}]),i}(_e),me=function(t){c(i,t);var e=_(i);function i(t,a,n){var r;return s(this,i),(r=e.call(this,t,a))._xAxis=n,r}return o(i,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().xAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value:function(t){var e=t.axisLine;e.show&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,mt(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a=t.axisLine.show?t.axisLine.size:0,n=a+i.length;this._xAxis.ticks().forEach((function(t){xt(e._ctx,t.x,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=t.tickText;if(e.show){var i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Kt(e.size,e.weight,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var a=e.paddingTop;t.axisLine.show&&(a+=t.axisLine.size),i.show&&(a+=i.length);for(var n=this._xAxis.ticks(),s=n.length,r=0;s>r;r++)this._ctx.fillText(n[r].v,n[r].x,a)}}}]),i}(Qt),xe=function(t){c(i,t);var e=_(i);function i(t,a,n){var r;return s(this,i),(r=e.call(this,t,a))._xAxis=n,r}return o(i,[{key:"_draw",value:function(){this._drawCrosshairLabel()}},{key:"_drawCrosshairLabel",value:function(){var t=this._chartData.crosshair();if(t.paneId){var e=this._chartData.styleOptions().crosshair,i=e.vertical,a=i.text;if(e.show&&i.show&&a.show&&t.dataIndex===t.realDataIndex){var n=t.realX,s=t.kLineData.timestamp,r=Q(this._chartData.dateTimeFormat(),s,"YYYY-MM-DD hh:mm"),o=a.size;this._ctx.font=Kt(o,a.weight,a.family);var h=Ut(this._ctx,r),c=n-h/2,l=a.paddingLeft,u=a.paddingRight,d=a.paddingTop,_=a.borderSize;l+_>c?c=l+_:c>this._width-h-_-u&&(c=this._width-h-_-u),ne(this._ctx,a.backgroundColor,a.borderColor,_,c-_-l,0,h+2*_+u+l,o+2*_+d+a.paddingBottom,a.borderRadius),this._ctx.textBaseline="top",ee(this._ctx,a.color,c,_+d,r)}}}}]),i}(Qt),ge=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_createMainView",value:function(t,e){return new me(t,e.chartData,e.xAxis)}},{key:"_createOverlayView",value:function(t,e){return new xe(t,e.chartData,e.xAxis)}}]),i}($t),ke=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_computeMinMax",value:function(){return{min:this._chartData.from(),max:this._chartData.to()-1}}},{key:"_optimalMinMax",value:function(t){var e=t.min,i=t.max;return{min:e,max:i,range:i-e+1}}},{key:"_optimalTicks",value:function(t){var e=[],i=t.length,a=this._chartData.dataList();if(i>0){var n=this._chartData.dateTimeFormat(),s=this._chartData.styleOptions().xAxis.tickText;this._measureCtx.font=Kt(s.size,s.weight,s.family);var r=Ut(this._measureCtx,"00-00 00:00"),o=this.convertToPixel(parseInt(t[0].v,10)),h=1;if(i>1){var c=this.convertToPixel(parseInt(t[1].v,10)),l=Math.abs(c-o);r>l&&(h=Math.ceil(r/l))}for(var u=0;i>u;u+=h){var d=parseInt(t[u].v,10),_=a[d].timestamp,v=Q(n,_,"hh:mm");if(0!==u)v=this._optimalTickLabel(n,_,a[parseInt(t[u-h].v,10)].timestamp)||v;var f=this.convertToPixel(d);e.push({v:v,x:f,oV:_})}if(1===e.length)e[0].v=Q(n,e[0].oV,"YYYY-MM-DD hh:mm");else{var p=e[0].oV,y=e[1].oV;if(e[2]){var m=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(m)?e[0].v=Q(n,p,"MM-DD"):/^[0-9]{4}-[0-9]{2}$/.test(m)?e[0].v=Q(n,p,"YYYY-MM"):/^[0-9]{4}$/.test(m)&&(e[0].v=Q(n,p,"YYYY"))}else e[0].v=this._optimalTickLabel(n,p,y)||e[0].v}}return e}},{key:"_optimalTickLabel",value:function(t,e,i){var a=Q(t,e,"YYYY"),n=Q(t,e,"YYYY-MM"),s=Q(t,e,"MM-DD");return a!==Q(t,i,"YYYY")?a:n!==Q(t,i,"YYYY-MM")?n:s!==Q(t,i,"MM-DD")?s:null}},{key:"getSelfHeight",value:function(){var t=this._chartData.styleOptions(),e=t.xAxis,i=e.height;if(D(i))return i;var a=t.crosshair,n=0;e.show&&(e.axisLine.show&&(n+=e.axisLine.size),e.tickLine.show&&(n+=e.tickLine.length),e.tickText.show&&(n+=e.tickText.paddingTop+e.tickText.paddingBottom+e.tickText.size));var s=0;return a.show&&a.vertical.show&&a.vertical.text.show&&(s+=a.vertical.text.paddingTop+a.vertical.text.paddingBottom+2*a.vertical.text.borderSize+a.vertical.text.size),Math.max(n,s)}},{key:"convertFromPixel",value:function(t){return this._chartData.coordinateToDataIndex(t)}},{key:"convertToPixel",value:function(t){return this._chartData.dataIndexToCoordinate(t)}}]),i}(ue),De=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"_initBefore",value:function(){this._xAxis=new ke(this._chartData)}},{key:"_createMainWidget",value:function(t,e){return new ge({container:t,chartData:e.chartData,xAxis:this._xAxis})}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setWidth",value:function(t,e){v(l(i.prototype),"setWidth",this).call(this,t,e),this._xAxis.setWidth(t)}},{key:"setHeight",value:function(t){v(l(i.prototype),"setHeight",this).call(this,t),this._xAxis.setHeight(t)}}]),i}(qt),we=0,be=2;function Pe(t){return t.getBoundingClientRect()||{left:0,top:0}}function Ee(t){return!!t.touches}function Me(t){t.cancelable&&t.preventDefault()}var Ce=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),Te="onorientationchange"in window&&Ce;function Ae(t,e){var i=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.sqrt(i*i+a*a)}var Se="mouse",Ie="touch",Le=function(){function t(e,i,a){s(this,t),this._target=e,this._handler=i,this._options=a,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return o(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this),a=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",a)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",a,{passive:!1}),Ee(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||Ee(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===we)&&null===this._startPinchMiddlePoint){var e=Ee(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,n=Math.abs(a.x-i.pageX),s=Math.abs(a.y-i.pageY),r=n+s>5;if(r||!e){if(r&&!this._moveExceededManhattanDistance&&e){var o=.5*n;s>=o&&!this._options.treatVertTouchDragAsPageScroll||o>s&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}r&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&Me(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===we){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Ee(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Ee(t)&&(Me(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===we||t.button===be){var e=this._makeCompatEvent(t);if("button"in t&&t.button===be)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Ee(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",i),n.removeEventListener("touchend",a),n.removeEventListener("mousemove",i),n.removeEventListener("mouseup",a)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),Ee(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(n.addEventListener("mousemove",i),n.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),Te||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var i=Ae(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddlePoint,i/t._startPinchDistance),Me(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=Pe(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=Ae(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=Pe(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?Se:Ie,target:e.target,view:t.view}}}]),t}(),Oe=function(){function t(e,i,a,n,r,o){s(this,t),this._chartData=i,this._topPaneId=a,this._bottomPaneId=n,this._dragEnabled=r,this._width=0,this._offsetLeft=0,this._dragEventHandler=o,this._dragFlag=!1,this._initElement(e),this._initEvent(r)}return o(t,[{key:"_initElement",value:function(t){this._container=t,this._wrapper=this._createElement(),this._wrapper.style.position="relative",this._element=this._createElement(),this._element.style.width="100%",this._element.style.position="absolute",this._element.style.zIndex="20",this._element.style.top="-3px",this._element.style.height="7px",this._wrapper.appendChild(this._element);var e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper)}},{key:"_initEvent",value:function(t){t&&(this._element.style.cursor="ns-resize",this._dragEvent=new Le(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}))}},{key:"_createElement",value:function(){var t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t}},{key:"_mouseDownEvent",value:function(t){this._dragFlag=!0,this._startY=t.pageY,this._dragEventHandler.startDrag(this._topPaneId,this._bottomPaneId)}},{key:"_mouseUpEvent",value:function(){this._dragFlag=!1,this._chartData.setDragPaneFlag(!1)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._topPaneId,this._bottomPaneId),this._chartData.setDragPaneFlag(!0),this._chartData.setCrosshair()}},{key:"_mouseEnterEvent",value:function(){var t=this._chartData.styleOptions().separator;this._element.style.background=t.activeBackgroundColor,this._chartData.setDragPaneFlag(!0),this._chartData.setCrosshair()}},{key:"_mouseLeaveEvent",value:function(){this._dragFlag||(this._element.style.background=null,this._chartData.setDragPaneFlag(!1))}},{key:"height",value:function(){return this._wrapper.offsetHeight}},{key:"setSize",value:function(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"setDragEnabled",value:function(t){t!==this._dragEnabled&&(this._dragEnabled=t,t?!this._dragEvent&&this._initEvent(t):(this._element.style.cursor="default",this._dragEvent&&this._dragEvent.destroy(),this._dragEvent=null))}},{key:"topPaneId",value:function(){return this._topPaneId}},{key:"bottomPaneId",value:function(){return this._bottomPaneId}},{key:"updatePaneId",value:function(t,e){w(t)&&(this._topPaneId=t),w(e)&&(this._bottomPaneId=e)}},{key:"invalidate",value:function(){var t=this._chartData.styleOptions().separator;this._element.style.top="".concat(-Math.floor((7-t.size)/2),"px"),this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value:function(){var t=this._chartData.styleOptions().separator,e=document.createElement("canvas"),i=e.getContext("2d"),a=Zt(e),n=this._wrapper.offsetWidth,s=t.size;return e.style.width="".concat(n,"px"),e.style.height="".concat(s,"px"),e.width=n*a,e.height=s*a,i.scale(a,a),i.fillStyle=t.color,i.fillRect(this._offsetLeft,0,n,s),e}},{key:"destroy",value:function(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}();function Fe(t){return t.type===Ie}function ze(t){return t.type===Se}var Re=function(){function t(e){s(this,t),this._chartData=e,this._chartContentSize={},this._paneContentSize={}}return o(t,[{key:"_checkEventPointX",value:function(t){return t>0&&this._chartContentSize.contentRight-this._chartContentSize.contentLeft>t}},{key:"setChartContentSize",value:function(t){this._chartContentSize=t}},{key:"setPaneContentSize",value:function(t){this._paneContentSize=t}}]),t}(),Be=function(t){c(i,t);var e=_(i);function i(t){var a;return s(this,i),(a=e.call(this,t))._startScrollPoint={},a._touchPoint=null,a._touchCancelCrossHair=!1,a._touchZoomed=!1,a._pinchScale=1,a}return o(i,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var i=5*(e-this._pinchScale);this._pinchScale=e,this._chartData.zoom(i,t)}},{key:"mouseLeaveEvent",value:function(t){ze(t)&&this._chartData.setCrosshair()}},{key:"mouseMoveEvent",value:function(t){var e=this;ze(t)&&this._performCross(t,!1,(function(i){e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})}),(function(){e._chartData.setCrosshair()}))}},{key:"mouseWheelEvent",value:function(t){if(this._checkEventPointX(t.localX))if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.cancelable&&t.preventDefault(),0===Math.abs(t.deltaX))return;this._chartData.startScroll(),this._chartData.scroll(-t.deltaX)}else{var e=-t.deltaY/100;if(0===e)return;switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartData.zoom(i,{x:t.localX,y:t.localY})}}}},{key:"mouseClickEvent",value:function(t){var e=this;this._performCross(t,!0,(function(i){e._touchPoint||e._touchCancelCrossHair||e._touchZoomed||(e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId}))}))}},{key:"mouseDownEvent",value:function(t){var e=this;this._startScrollPoint={x:t.localX,y:t.localY},this._chartData.startScroll(),this._performCross(t,!0,(function(i){if(e._touchZoomed=!1,e._touchPoint){var a=t.localX-e._touchPoint.x,n=t.localY-e._touchPoint.y;10>Math.sqrt(a*a+n*n)?(e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})):(e._touchCancelCrossHair=!0,e._touchPoint=null,e._chartData.setCrosshair())}else e._touchCancelCrossHair=!1}))}},{key:"pressedMouseMoveEvent",value:function(t){var e=this;this._performCross(t,!1,(function(i){var a={x:t.localX,y:i.y,paneId:i.paneId};if(Fe(t)){if(e._touchPoint)return e._touchPoint={x:t.localX,y:t.localY},void e._chartData.setCrosshair(a);a=null}e._chartData.scroll(t.localX-e._startScrollPoint.x,a)}))}},{key:"longTapEvent",value:function(t){var e=this;this._performCross(t,!0,(function(i){e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})}))}},{key:"_performCross",value:function(t,e,i,a){if(!e||Fe(t))if(this._checkEventPointX(t.localX)){var n=!1;for(var s in this._paneContentSize){var r=this._paneContentSize[s];if(t.localY>r.contentTop&&r.contentBottom>t.localY){n=!0,i&&i({paneId:s,y:t.localY-r.contentTop});break}}!n&&a&&a()}else a&&a()}}]),i}(Re),He=function(t){c(i,t);var e=_(i);function i(t){var a;return s(this,i),(a=e.call(this,t))._pressedGraphicMark=null,a}return o(i,[{key:"_performOverlayMouseHover",value:function(t,e,i,a){var n,s,r=p(t);try{for(r.s();!(s=r.n()).done;){if(n=s.value.checkMousePointOnGraphic(i))break}}catch(t){r.e(t)}finally{r.f()}return n&&e.id===n.id||(e.id&&e.instance&&ze(a)&&e.instance.onMouseLeave({id:e.id,points:e.instance.points(),event:a}),n&&n.id!==e.id&&n.instance&&ze(a)&&n.instance.onMouseEnter({id:n.id,points:n.instance.points(),event:a})),n}},{key:"mouseUpEvent",value:function(t){this._pressedGraphicMark&&(this._pressedGraphicMark=null,this._chartData.setDragGraphicMarkFlag(!1))}},{key:"mouseMoveEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)&&!this._waitingForMouseMoveAnimationFrame){this._waitingForMouseMoveAnimationFrame=!0;var e,i,a,n={x:t.localX,y:t.localY},s=this._chartData.graphicMarks(),r=this._chartData.visibleAnnotations(),o=s[s.length-1],h=this._chartData.graphicMarkMouseOperate().hover,c=this._chartData.annotationMouseOperate();o&&o.isDrawing()?(o.mouseMoveForDrawing(n),e=o.checkMousePointOnGraphic(n),i={id:"",element:wt,elementIndex:-1}):(e=this._performOverlayMouseHover(s,h,n,t),a=this._performOverlayMouseHover(r,c,n,t)),this._chartData.setOverlayMouseOperate({hover:e||{id:"",element:wt,elementIndex:-1},click:i},a||{id:""}),this._waitingForMouseMoveAnimationFrame=!1}}},{key:"mouseDownEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){var e,i={x:t.localX,y:t.localY},n=this._chartData.graphicMarks(),s=n[n.length-1],r={id:"",element:wt,elementIndex:-1};if(s&&s.isDrawing())s.mouseLeftButtonDownForDrawing(i),e=s.checkMousePointOnGraphic(i);else{var o,h=p(n);try{for(h.s();!(o=h.n()).done;){var c=o.value;if(e=c.checkMousePointOnGraphic(i)){e.element===Dt&&(this._pressedGraphicMark=c,this._chartData.setDragGraphicMarkFlag(!0),r=a({},e)),c.onClick({id:e.id,points:c.points(),event:t});break}}}catch(t){h.e(t)}finally{h.f()}var l,u=p(this._chartData.visibleAnnotations());try{for(u.s();!(l=u.n()).done;){var d=l.value,_=d.checkMousePointOnGraphic(i);if(_){d.onClick({id:_.id,points:d.points(),event:t});break}}}catch(t){u.e(t)}finally{u.f()}}this._chartData.setOverlayMouseOperate({hover:r,click:e||{id:"",element:wt,elementIndex:-1}})}}},{key:"mouseRightDownEvent",value:function(t){var e=this._chartData.graphicMarks().find((function(e){return e.checkMousePointOnGraphic({x:t.localX,y:t.localY})}));e&&!e.onRightClick({id:e.id(),points:e.points(),event:t})&&this._chartData.removeGraphicMarkInstance(e.id());var i=this._chartData.visibleAnnotations().find((function(e){return e.checkMousePointOnGraphic({x:t.localX,y:t.localY})}));i&&i.onRightClick({id:i.id(),points:i.points(),event:t})}},{key:"pressedMouseMoveEvent",value:function(t){var e=this._chartData.graphicMarks(),i=e[e.length-1];i&&i.isDrawing()||!this._pressedGraphicMark||(this._pressedGraphicMark.mousePressedMove({x:t.localX,y:t.localY},t),this._chartData.invalidate(Wt))}},{key:"_checkEventPointY",value:function(t){var e=this._paneContentSize.candle_pane;return t>e.contentTop&&e.contentBottom>t}}]),i}(Re),Ve="Equal",Ye="Minus",We="ArrowLeft",Ne="ArrowRight",Ge=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return o(i,[{key:"keyBoardDownEvent",value:function(t){if(t.shiftKey)switch(t.code){case Ve:this._chartData.zoom(.5);break;case Ye:this._chartData.zoom(-.5);break;case We:this._chartData.startScroll(),this._chartData.scroll(-3*this._chartData.dataSpace());break;case Ne:this._chartData.startScroll(),this._chartData.scroll(3*this._chartData.dataSpace())}}}]),i}(Re),Xe=function(){function t(e,i){s(this,t),this._target=e,this._chartData=i,this._chartContentSize={},this._event=new Le(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new Be(i),this._overlayEventHandler=new He(i),this._keyBoardEventHandler=new Ge(i)}return o(t,[{key:"_keyBoardDownEvent",value:function(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value:function(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._target.style.cursor="crosshair",this._shouldPerformOverlayEvent()&&(t.localX-=this._chartContentSize.contentLeft,this._overlayEventHandler.mouseUpEvent(t))}},{key:"_mouseLeaveEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.mouseLeaveEvent(t))}},{key:"_mouseMoveEvent",value:function(t){t.localX-=this._chartContentSize.contentLeft,this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseMoveEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseMoveEvent(t)}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseWheelEvent(t)}},{key:"_mouseClickEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.mouseClickEvent(t))}},{key:"_mouseDownEvent",value:function(t){this._target.style.cursor="pointer",t.localX-=this._chartContentSize.contentLeft,this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseDownEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseDownEvent(t)}},{key:"_mouseRightDownEvent",value:function(t){this._shouldPerformOverlayEvent()&&(t.localX-=this._chartContentSize.contentLeft,this._overlayEventHandler.mouseRightDownEvent(t))}},{key:"_pressedMouseMoveEvent",value:function(t){t.localX-=this._chartContentSize.contentLeft,this._chartData.dragGraphicMarkFlag()&&(this._overlayEventHandler.pressedMouseMoveEvent(t),this._chartData.crosshair().paneId&&this._chartData.setCrosshair()),this._checkZoomScroll()&&this._zoomScrollEventHandler.pressedMouseMoveEvent(t)}},{key:"_longTapEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.longTapEvent(t))}},{key:"_checkZoomScroll",value:function(){var t=this._chartData.graphicMarks(),e=t.length;return!(this._chartData.dragPaneFlag()||this._chartData.dragGraphicMarkFlag()||0!==e&&t[e-1].isDrawing())}},{key:"_shouldPerformOverlayEvent",value:function(){return this._chartData.graphicMarks().length>0||this._chartData.visibleAnnotations().length>0}},{key:"setChartContentSize",value:function(t){this._chartContentSize=t,this._zoomScrollEventHandler.setChartContentSize(t),this._overlayEventHandler.setChartContentSize(t)}},{key:"setPaneContentSize",value:function(t){this._zoomScrollEventHandler.setPaneContentSize(t),this._overlayEventHandler.setPaneContentSize(t)}},{key:"destroy",value:function(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}();function je(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=0;return function(){var a=Date.now(),n=this,s=arguments;a-i>e&&(t.apply(n,s),i=a)}}var Ze=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,r=t.point,o=t.chartData,h=t.xAxis,c=t.yAxis,l=t.styles;return s(this,i),(a=e.call(this,{id:n,chartData:o,xAxis:h,yAxis:c}))._point=r,a._symbolCoordinate={},a.setStyles(l,o.styleOptions().annotation),a}return o(i,[{key:"_drawSymbol",value:function(t,e,i){var a=this._chartData.barSpace(),n=i.symbol,s=n.size,r=n.activeSize,o=e?D(r)?r:a:D(s)?s:a,h=e?n.activeColor:n.color;switch(n.type){case N:ft(t,h,this._symbolCoordinate,o/2);break;case G:!function(t,e,i,a,n,s){t.fillStyle=e,t.fillRect(i,a,n,s)}(t,h,this._symbolCoordinate.x-o/2,this._symbolCoordinate.y-o/2,o,o);break;case j:!function(t,e,i,a,n){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y),t.lineTo(i.x,i.y-n/2),t.lineTo(i.x+a/2,i.y),t.lineTo(i.x,i.y+n/2),t.closePath(),t.fill()}(t,h,this._symbolCoordinate,o,o);break;case X:!function(t,e,i,a,n){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y+n/2),t.lineTo(i.x,i.y-n/2),t.lineTo(i.x+a/2,i.y+n/2),t.closePath(),t.fill()}(t,h,this._symbolCoordinate,o,o);break;case Z:this.drawCustomSymbol({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height(),barSpace:a},styles:n,isActive:e})}}},{key:"draw",value:function(t){var e=this._styles||this._chartData.styleOptions().annotation,i=e.symbol,a=i.offset||[],n=0;switch(i.position){case U:n=this._yAxis.convertToPixel(this._point.price);break;case K:n=0;break;case q:n=this._yAxis.height()}this._symbolCoordinate.y=n+(a[1]||0);var s=this._id===this._chartData.annotationMouseOperate().id;this._drawSymbol(t,s,e),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},styles:e,isActive:s}),t.restore())}},{key:"checkMousePointOnGraphic",value:function(t){var e,i,a,n,s=this._chartData.barSpace(),r=(this._styles||this._chartData.styleOptions().annotation).symbol,o=D(r.size)?r.size:s;switch(r.type){case N:e=yt(this._symbolCoordinate,o/2,t);break;case G:a={x:this._symbolCoordinate.x+o/2,y:this._symbolCoordinate.y+o/2},e=!((i={x:this._symbolCoordinate.x-o/2,y:this._symbolCoordinate.y-o/2}).x>(n=t).x||n.x>a.x||i.y>n.y||n.y>a.y);break;case j:e=function(t,e,i,a){return e*i/2+2>Math.abs(t.x-a.x)*i+Math.abs(t.y-a.y)*e}(this._symbolCoordinate,o,o,t);break;case X:e=function(t,e){var i=pt(t[0],t[1],t[2]),a=pt(t[0],t[1],e)+pt(t[0],t[2],e)+pt(t[1],t[2],e);return 2>Math.abs(i-a)}([{x:this._symbolCoordinate.x-o/2,y:this._symbolCoordinate.y+o/2},{x:this._symbolCoordinate.x,y:this._symbolCoordinate.y-o/2},{x:this._symbolCoordinate.x+o/2,y:this._symbolCoordinate.y+o/2}],t);break;case Z:e=this.checkPointInCustomSymbol({mouseCoordinate:t,coordinate:this._symbolCoordinate,size:o})}if(e)return{id:this._id,instance:this}}},{key:"createSymbolCoordinate",value:function(t){var e=this._styles||this._chartData.styleOptions().annotation;this._symbolCoordinate={x:t+((e.symbol.offset||[])[0]||0)}}},{key:"points",value:function(){return this._point}},{key:"checkPointInCustomSymbol",value:function(t){}},{key:"drawCustomSymbol",value:function(t){}}]),i}(vt),Ue=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,r=t.point,o=t.text,h=t.mark,c=t.chartData,l=t.xAxis,u=t.yAxis,d=t.styles;return s(this,i),(a=e.call(this,{id:n,chartData:c,xAxis:l,yAxis:u}))._point=r||{},a._text=o,a._mark=h,a.setStyles(d,c.styleOptions().tag),a}return o(i,[{key:"update",value:function(t){var e=t.point,i=t.text,a=t.mark,n=t.styles,s=!1;return k(e)&&(this._point=e,s=!0),w(i)&&(this._text=i,s=!0),w(a)&&(this._mark=a,s=!0),this.setStyles(n,this._chartData.styleOptions().tag)&&(s=!0),s}},{key:"drawMarkLine",value:function(t){var e=this._chartData.styleOptions(),i=e.yAxis,a=this._styles||e.tag,n=this._getY(a);t.save(),this._drawLine(t,n,a.line),this._drawMark(t,n,a,i),t.restore()}},{key:"drawText",value:function(t){if(w(this._text)){var e=this._chartData.styleOptions(),i=this._styles||e.tag,a=i.text;t.font=Kt(a.size,a.weight,a.family);var n,s=this._getTextRectWidth(t,a),r=a.paddingTop+a.paddingBottom+a.size;n=this._yAxis.isFromYAxisZero()?0:this._yAxis.width()-s;var o=this._getY(i);re(t,a.backgroundColor,n,o-r/2,s,r,a.borderRadius),ee(t,a.color,n+a.paddingLeft,o,this._text)}}},{key:"_drawLine",value:function(t,e,i){i.show&&(t.strokeStyle=i.color,t.lineWidth=i.size,i.style===M&&t.setLineDash(i.dashValue),mt(t,e,0,this._xAxis.width()))}},{key:"_drawMark",value:function(t,e,i,a){if(w(this._mark)){var n=i.mark;t.font=Kt(n.size,n.weight,n.family);var s,r=n.paddingLeft+n.paddingRight+Ut(t,this._mark),o=n.paddingTop+n.paddingBottom+n.size;if(a.inside){var h=0;w(this._text)&&(h=this._getTextRectWidth(t,i.text)),s=a.position===C?h:this._xAxis.width()-h-r}else s=a.position===C?0:this._xAxis.width()-r;re(t,n.backgroundColor,s,e-o/2,r,o,n.borderRadius),t.textBaseline="middle",t.font=Kt(n.size,n.weight,n.family),ee(t,n.color,s+n.paddingLeft,e,this._mark)}}},{key:"_getY",value:function(t){var e=t.offset;switch(t.position){case K:return e;case q:return this._yAxis.height()+e;default:return this._yAxis.convertToNicePixel(this._point.price)+e}}},{key:"_getTextRectWidth",value:function(t,e){return t.font=Kt(e.size,e.weight,e.family),e.paddingLeft+e.paddingRight+Ut(t,this._text)}}]),i}(vt),Ke=function(){function t(e,i){s(this,t),this._initChartContainer(e),this._graphicMarkBaseId=0,this._paneBaseId=0,this._separatorDragStartTopPaneHeight=0,this._separatorDragStartBottomPaneHeight=0,this._chartData=new jt(i,{invalidate:this._invalidatePane.bind(this),crosshair:this._crosshairObserver.bind(this)}),this._xAxisPane=new De({container:this._chartContainer,chartData:this._chartData}),this._panes=new Map([[Yt,new ye({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),id:Yt})]]),this._separators=new Map,this._chartWidth={},this._chartHeight={},this._chartEvent=new Xe(this._chartContainer,this._chartData),this.adjustPaneViewport(!0,!0,!0)}return o(t,[{key:"_initChartContainer",value:function(t){this._container=t,this._chartContainer=document.createElement("div"),this._chartContainer.style.userSelect="none",this._chartContainer.style.webkitUserSelect="none",this._chartContainer.style.msUserSelect="none",this._chartContainer.style.MozUserSelect="none",this._chartContainer.style.webkitTapHighlightColor="transparent",this._chartContainer.style.position="relative",this._chartContainer.style.outline="none",this._chartContainer.style.borderStyle="none",this._chartContainer.style.width="100%",this._chartContainer.style.cursor="crosshair",this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_crosshairObserver",value:function(t){var e=t.dataIndex,i=t.kLineData,a=t.x,n=t.y;if(this.chartData().hasAction(Xt.CROSSHAIR)){var s={};this._panes.forEach((function(t,i){var a={};t.technicalIndicators().forEach((function(t){a[t.name]=t.result[e]})),s[i]=a})),this._chartData.actionExecute(Xt.CROSSHAIR,{coordinate:{x:a,y:n},dataIndex:e,kLineData:i,technicalIndicatorData:s})}}},{key:"_separatorStartDrag",value:function(t,e){this._separatorDragStartTopPaneHeight=this._panes.get(t).height(),this._separatorDragStartBottomPaneHeight=this._panes.get(e).height()}},{key:"_separatorDrag",value:function(t,e,i){var a=this._separatorDragStartTopPaneHeight+t,n=this._separatorDragStartBottomPaneHeight-t;a>this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight&&(a=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight,n=0),0>a&&(a=0,n=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight),this._panes.get(e).setHeight(a),this._panes.get(i).setHeight(n),this._chartData.actionExecute(Xt.PANE_DRAG,{topPaneId:e,bottomPaneId:i,topPaneHeight:a,bottomPaneHeight:n}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"_invalidatePane",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gt;if(t===Wt)this._xAxisPane.invalidate(t),this._panes.forEach((function(e){e.invalidate(t)}));else{var e=!1;this._panes.forEach((function(t){var i=t.yAxis().computeAxis();i&&(e=i)})),this.adjustPaneViewport(!1,e,!0)}}},{key:"_calcAllPaneTechnicalIndicator",value:function(){var t=this,e=[];this._panes.forEach((function(t){e.push(Promise.resolve(t.calcAllTechnicalIndicator()))})),Promise.all(e).then((function(e){var i=e.indexOf(!0)>-1;t.adjustPaneViewport(!1,i,!0)}))}},{key:"_measurePaneHeight",value:function(){var t=this,e=this._chartData.styleOptions(),i=this._container.offsetHeight,a=e.separator.size,n=a*this._separators.size,s=this._xAxisPane.xAxis().getSelfHeight(),r=i-s-n,o=0;this._panes.forEach((function(t){if(t.id()!==Yt){var e=t.height();o+e>r?(t.setHeight(r-o),o=r):o+=e}}));var h=r-o,c={};c.candle_pane={contentTop:0,contentBottom:h};var l=h,u=h;this._panes.get(Yt).setHeight(h),this._chartHeight.candle_pane=h,this._panes.forEach((function(e){if(e.id()!==Yt){var i=e.height();u+=i+a,c[e.id()]={contentTop:l,contentBottom:u},t._chartHeight[e.id()]=i,l=u}})),this._xAxisPane.setHeight(s),this._chartHeight.xAxis=s,this._chartHeight.total=i,this._chartEvent.setPaneContentSize(c)}},{key:"_measurePaneWidth",value:function(){var t,e,i,a=this,n=this._chartData.styleOptions().yAxis,s=n.position===C,r=this._container.offsetWidth,o=Number.MIN_SAFE_INTEGER;!n.inside?(this._panes.forEach((function(t){o=Math.max(o,t.yAxis().getSelfWidth())})),t=r-o,s?(e=0,i=o):(i=0,e=r-o)):(t=r,o=r,e=0,i=0),this._chartData.setTotalDataSpace(t),this._panes.forEach((function(n,s){n.setWidth(t,o),n.setOffsetLeft(i,e);var r=a._separators.get(s);r&&r.setSize(i,t)})),this._chartWidth={content:t,yAxis:o,total:r},this._xAxisPane.setWidth(t,o),this._xAxisPane.setOffsetLeft(i,e),this._chartEvent.setChartContentSize({contentLeft:i,contentRight:i+t})}},{key:"adjustPaneViewport",value:function(t,e,i,a,n){t&&this._measurePaneHeight();var s=!1;a&&this._panes.forEach((function(t){var e=t.yAxis().computeAxis(n);s||(s=e)})),(!a&&e||a&&s)&&this._measurePaneWidth(),i&&(this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.layout(),this._panes.forEach((function(t){t.layout()})))}},{key:"chartData",value:function(){return this._chartData}},{key:"overrideTechnicalIndicator",value:function(t,e){var i=this,a=e.name,n=e.calcParams,s=e.precision,r=e.styles;t.setCalcParamsAllowDecimal(e.calcParamsAllowDecimal);var o=t.setCalcParams(n),h=t.setPrecision(s),c=this._chartData.styleOptions().technicalIndicator,l=t.setStyles(r,c);if(o||h||l){var u=!1,d=[];this._panes.forEach((function(t){var e=t.technicalIndicators();if(e.has(a)){u=!0;var i=e.get(a);o&&d.push(Promise.resolve(t.calcTechnicalIndicator(i)))}})),u&&Promise.all(d).then((function(t){i.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"_applyDataList",value:function(t,e,i){x(t)&&(g(i)&&i(),this._chartData.addData(t,0,e),this._calcAllPaneTechnicalIndicator())}},{key:"applyNewData",value:function(t,e){var i=this;this._applyDataList(t,e,(function(){i._chartData.clearDataList()}))}},{key:"applyMoreData",value:function(t,e){this._applyDataList(t,e)}},{key:"updateData",value:function(t){var e=this._chartData.dataList(),i=e.length,a=J(t,"timestamp",0),n=J(e[i-1],"timestamp",0);if(a>=n){var s=i;a===n&&(s=i-1),this._chartData.addData(t,s),this._calcAllPaneTechnicalIndicator()}}},{key:"removeTechnicalIndicator",value:function(t,e){var i=this;if(this._panes.has(t))if(t===Yt)this._panes.get(Yt).removeTechnicalIndicator(e)&&this.adjustPaneViewport(!1,!0,!0,!0);else{var a=this._panes.get(t),n=a.removeTechnicalIndicator(e);if(a.isEmptyTechnicalIndicator()){a.destroy();var s=this._separators.get(t).topPaneId();this._separators.get(t).destroy(),this._panes.delete(t),this._separators.delete(t),this._separators.forEach((function(t){var e=t.topPaneId();i._separators.has(e)||t.updatePaneId(s)})),this.adjustPaneViewport(!0,!0,!0,!0,!0)}else n&&this.adjustPaneViewport(!1,!0,!0,!0)}}},{key:"createTechnicalIndicator",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._panes.has(i.id))return this.setPaneOptions(i,this._panes.get(i.id).setTechnicalIndicator(t,e)),i.id;var a=i.id||"".concat(Ht).concat(++this._paneBaseId),n=!b(i.dragEnabled)||i.dragEnabled;return this._separators.set(a,new Oe(this._chartContainer,this._chartData,Array.from(this._panes.keys()).pop(),a,n,{startDrag:this._separatorStartDrag.bind(this),drag:je(this._separatorDrag.bind(this),50)})),this._panes.set(a,new _e({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),name:t.name,id:a,height:i.height||100})),this.adjustPaneViewport(!0,!0,!0,!0,!0),a}},{key:"getPaneTechnicalIndicator",value:function(t){var e=function(t){var e={};return t.technicalIndicators().forEach((function(t){e[t.name]=dt(t)})),e};if(!w(t)){var i={};return this._panes.forEach((function(t){i[t.id()]=e(t)})),i}return this._panes.has(t)?e(this._panes.get(t)):{}}},{key:"createGraphicMark",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.id,a=e.points,n=e.styles,s=e.lock,r=e.onDrawStart,o=e.onDrawing,h=e.onDrawEnd,c=e.onClick,l=e.onRightClick,u=e.onPressedMove,d=e.onMouseEnter,_=e.onMouseLeave,v=e.onRemove,f=i||"".concat(Vt).concat(++this._graphicMarkBaseId),p=new t({id:f,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),yAxis:this._panes.get(Yt).yAxis(),points:a,styles:n,lock:s});if(g(r)&&(p.onDrawStart=r,p.onDrawStart({id:f})),g(o)&&(p.onDrawing=o),g(h)&&(p.onDrawEnd=h),g(c)&&(p.onClick=c),g(l)&&(p.onRightClick=l),g(u)&&(p.onPressedMove=u),g(d)&&(p.onMouseEnter=d),g(_)&&(p.onMouseLeave=_),g(v)&&(p.onRemove=v),this._chartData.addGraphicMarkInstance(p))return f}},{key:"createAnnotation",value:function(t){var e=this,i=[];t.forEach((function(t){var a=t.point,n=t.styles,s=t.checkPointInCustomSymbol,r=t.drawCustomSymbol,o=t.drawExtend,h=t.onClick,c=t.onRightClick,l=t.onMouseEnter,u=t.onMouseLeave;if(a&&a.timestamp){var d=new Ze({id:a.timestamp,chartData:e._chartData,point:a,xAxis:e._xAxisPane.xAxis(),yAxis:e._panes.get(Yt).yAxis(),styles:n});g(o)&&(d.drawExtend=o),g(s)&&(d.checkPointInCustomSymbol=s),g(r)&&(d.drawCustomSymbol=r),g(h)&&(d.onClick=h),g(c)&&(d.onRightClick=c),g(l)&&(d.onMouseEnter=l),g(u)&&(d.onMouseLeave=u),i.push(d)}})),i.length>0&&this._chartData.addAnnotations(i)}},{key:"createTag",value:function(t){var e=this,i=[],a=!1,n=!1;t.forEach((function(t){var s=t.id,r=t.point,o=t.text,h=t.mark,c=t.styles;if(w(s)){var l=e._chartData.getTag(s);if(l){var u=l.update({point:r,text:o,mark:h,styles:c});a||(a=u)}else n=!0,i.push(new Ue({id:s,point:r,text:o,mark:h,styles:c,chartData:e._chartData,xAxis:e._xAxisPane.xAxis(),yAxis:e._panes.get(Yt).yAxis()}))}})),n?this._chartData.addTags(i):a&&this._invalidatePane(Wt)}},{key:"setPaneOptions",value:function(t,e){var i=e,a=!1;if(t.id!==Yt){var n=this._panes.get(t.id);n&&(D(t.height)&&t.height>0&&n.height()!==t.height&&(i=!0,n.setHeight(t.height),a=!0),b(t.dragEnabled)&&this._separators.get(t.id).setDragEnabled(t.dragEnabled))}i&&this.adjustPaneViewport(a,!0,!0,!0)}},{key:"setTimezone",value:function(t){this._chartData.setTimezone(t),this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.invalidate(Gt)}},{key:"convertToPixel",value:function(t,e){var i,a=this,n=e.paneId,s=void 0===n?Yt:n,r=e.dataIndexXAxis,o=e.absoluteYAxis,h=[].concat(t),c=[],l=this._chartData.styleOptions().separator.size,u=0,d=p(this._panes.values());try{var _=function(){var t=i.value;if(t.id()===s)return c=h.map((function(e){var i=e.xAxisValue,n=e.yAxisValue,s={};if(w(i)){var h=r?i:a._chartData.timestampToDataIndex(i);s.x=a._xAxisPane.xAxis().convertToPixel(h)}if(w(n)){var c=t.yAxis().convertToPixel(n);s.y=o?u+c:c}return s})),"break";u+=t.height()+l};for(d.s();!(i=d.n()).done;){if("break"===_())break}}catch(t){d.e(t)}finally{d.f()}return x(t)?c:c[0]||{}}},{key:"convertFromPixel",value:function(t,e){var i,a=this,n=e.paneId,s=void 0===n?Yt:n,r=e.dataIndexXAxis,o=e.absoluteYAxis,h=[].concat(t),c=[],l=this._chartData.styleOptions().separator.size,u=0,d=p(this._panes.values());try{var _=function(){var t=i.value;if(t.id()===s)return c=h.map((function(e){var i=e.x,n=e.y,s={};if(w(i)){var h=a._xAxisPane.xAxis().convertFromPixel(i);s.xAxisValue=r?h:a._chartData.dataIndexToTimestamp(h)}if(w(n)){var c=o?n-u:n;s.yAxisValue=t.yAxis().convertFromPixel(c)}return s})),"break";u+=t.height()+l};for(d.s();!(i=d.n()).done;){if("break"===_())break}}catch(t){d.e(t)}finally{d.f()}return x(t)?c:c[0]||{}}},{key:"chartWidth",value:function(){return this._chartWidth}},{key:"chartHeight",value:function(){return this._chartHeight}},{key:"getConvertPictureUrl",value:function(t,e,i){var a=this,n=document.createElement("canvas"),s=n.getContext("2d"),r=Zt(n),o=this._chartContainer.offsetWidth,h=this._chartContainer.offsetHeight;n.style.width="".concat(o,"px"),n.style.height="".concat(h,"px"),n.width=o*r,n.height=h*r,s.scale(r,r),s.fillStyle=i,s.fillRect(0,0,o,h);var c=0;return this._panes.forEach((function(e,i){if(i!==Yt){var n=a._separators.get(i);s.drawImage(n.getImage(),0,c,o,n.height()),c+=n.height()}s.drawImage(e.getImage(t),0,c,o,e.height()),c+=e.height()})),s.drawImage(this._xAxisPane.getImage(t),0,c,o,this._xAxisPane.height()),n.toDataURL("image/".concat(e))}},{key:"destroy",value:function(){this._panes.forEach((function(t){t.destroy()})),this._separators.forEach((function(t){t.destroy()})),this._panes.clear(),this._separators.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),qe=function(){function t(e,i){s(this,t),this._chartPane=new Ke(e,i)}return o(t,[{key:"getWidth",value:function(){return this._chartPane.chartWidth()}},{key:"getHeight",value:function(){return this._chartPane.chartHeight()}},{key:"setStyleOptions",value:function(t){k(t)&&(this._chartPane.chartData().applyStyleOptions(t),this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0))}},{key:"getStyleOptions",value:function(){return m(this._chartPane.chartData().styleOptions())}},{key:"overrideTechnicalIndicator",value:function(t){if(k(t)){var e=this._chartPane.chartData().getTechnicalIndicatorInstance(t.name);e&&this._chartPane.overrideTechnicalIndicator(e,t)}}},{key:"getTechnicalIndicatorByName",value:function(t){return this._chartPane.chartData().getTechnicalIndicatorInfo(t)}},{key:"getTechnicalIndicatorByPaneId",value:function(t){return this._chartPane.getPaneTechnicalIndicator(t)}},{key:"setPriceVolumePrecision",value:function(t,e){D(t)&&t>=0&&D(e)&&e>=0&&this._chartPane.chartData().setPriceVolumePrecision(t,e)}},{key:"setTimezone",value:function(t){this._chartPane.setTimezone(t)}},{key:"getTimezone",value:function(){return this._chartPane.chartData().timezone()}},{key:"resize",value:function(){this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"setOffsetRightSpace",value:function(t){D(t)&&this._chartPane.chartData().setOffsetRightSpace(t,!0)}},{key:"setLeftMinVisibleBarCount",value:function(t){D(t)&&t>0&&this._chartPane.chartData().setLeftMinVisibleBarCount(Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value:function(t){D(t)&&t>0&&this._chartPane.chartData().setRightMinVisibleBarCount(Math.ceil(t))}},{key:"setDataSpace",value:function(t){D(t)&&this._chartPane.chartData().setDataSpace(t)}},{key:"clearData",value:function(){this._chartPane.chartData().clearDataList()}},{key:"getDataList",value:function(){return this._chartPane.chartData().dataList()}},{key:"applyNewData",value:function(t,e){x(t)&&this._chartPane.applyNewData(t,e)}},{key:"applyMoreData",value:function(t,e){x(t)&&this._chartPane.applyMoreData(t,e)}},{key:"updateData",value:function(t){k(t)&&!x(t)&&this._chartPane.updateData(t)}},{key:"loadMore",value:function(t){g(t)&&this._chartPane.chartData().setLoadMoreCallback(t)}},{key:"createTechnicalIndicator",value:function(t,e,i){var a=this._chartPane.chartData().getTechnicalIndicatorInstance(t);return a?this._chartPane.createTechnicalIndicator(a,e,i):null}},{key:"addCustomTechnicalIndicator",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.chartData().addCustomTechnicalIndicator(e)}}},{key:"removeTechnicalIndicator",value:function(t,e){this._chartPane.removeTechnicalIndicator(t,e)}},{key:"createGraphicMark",value:function(t,e){var i=this._chartPane.chartData().graphicMarkMapping()[t];return i?this._chartPane.createGraphicMark(i,e):null}},{key:"getGraphicMark",value:function(t){return this._chartPane.chartData().getGraphicMark(t)}},{key:"setGraphicMarkOptions",value:function(t,e){this._chartPane.chartData().setGraphicMarkOptions(t,e)}},{key:"addCustomGraphicMark",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.chartData().addCustomGraphicMark(e)}}},{key:"removeGraphicMark",value:function(t){this._chartPane.chartData().removeGraphicMarkInstance(t)}},{key:"createAnnotation",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.createAnnotation(e)}}},{key:"removeAnnotation",value:function(t){this._chartPane.chartData().removeAnnotation(t)}},{key:"createTag",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.createTag(e)}}},{key:"removeTag",value:function(t){this._chartPane.chartData().removeTag(t)}},{key:"setPaneOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._chartPane.setPaneOptions(t,!1)}},{key:"setZoomEnabled",value:function(t){this._chartPane.chartData().setZoomEnabled(t)}},{key:"isZoomEnabled",value:function(){return this._chartPane.chartData().zoomEnabled()}},{key:"setScrollEnabled",value:function(t){this._chartPane.chartData().setScrollEnabled(t)}},{key:"isScrollEnabled",value:function(){return this._chartPane.chartData().scrollEnabled()}},{key:"scrollByDistance",value:function(t,e){var i=this;if(D(t))if(D(e)&&e>0){this._chartPane.chartData().startScroll();var a=(new Date).getTime();!function n(){var s=((new Date).getTime()-a)/e,r=s>=1,o=r?t:t*s;i._chartPane.chartData().scroll(o),r||Jt(n)}()}else this._chartPane.chartData().startScroll(),this._chartPane.chartData().scroll(t)}},{key:"scrollToRealTime",value:function(t){var e=(this._chartPane.chartData().offsetRightBarCount()-this._chartPane.chartData().offsetRightSpace()/this._chartPane.chartData().dataSpace())*this._chartPane.chartData().dataSpace();this.scrollByDistance(e,t)}},{key:"scrollToPosition",value:function(t,e){if(D(t)){var i=(this._chartPane.chartData().dataList().length-1-t)*this._chartPane.chartData().dataSpace();this.scrollByDistance(i,e)}}},{key:"zoomAtCoordinate",value:function(t,e,i){var a=this;if(D(t))if(D(i)&&i>0){var n=this._chartPane.chartData().dataSpace(),s=n*t-n,r=(new Date).getTime();!function t(){var o=((new Date).getTime()-r)/i,h=o>=1,c=h?s:s*o;a._chartPane.chartData().zoom(c/n,e),h||Jt(t)}()}else this._chartPane.chartData().zoom(t,e)}},{key:"zoomAtPosition",value:function(t,e,i){if(D(t)&&D(e)){var a=this._chartPane.chartData().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:a},i)}}},{key:"convertToPixel",value:function(t,e){return this._chartPane.convertToPixel(t,e)}},{key:"convertFromPixel",value:function(t,e){return this._chartPane.convertFromPixel(t,e)}},{key:"subscribeAction",value:function(t,e){this._chartPane.chartData().subscribeAction(t,e)}},{key:"unsubscribeAction",value:function(t,e){this._chartPane.chartData().unsubscribeAction(t,e)}},{key:"getConvertPictureUrl",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#FFFFFF";if("png"===i||"jpeg"===i||"bmp"===i)return this._chartPane.getConvertPictureUrl(t,i,a)}},{key:"destroy",value:function(){this._chartPane.destroy()}}]),t}(),$e={},Je=1,Qe="k_line_chart_";t.dispose=function(t){if(t){var e;if(P(t)){var i=document.getElementById(t);e=i&&i.chartId}else E(t)?e=t.chartId:t instanceof qe&&(e=t.id);e&&($e[e].destroy(),delete $e[e])}},t.extension=e,t.init=function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;if(!E(e=P(t)?document.getElementById(t):t))return null;var a=$e[e.chartId||""];if(a)return a;var n="".concat(Qe).concat(Je++);return(a=new qe(e,i)).id=n,e.chartId=n,$e[n]=a,a},t.version=function(){return"7.5.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
